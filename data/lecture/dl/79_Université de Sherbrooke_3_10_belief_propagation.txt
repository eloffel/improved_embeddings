neural networks
conditional random    elds - belief propagation

c

c

c
c

c

2

c,i
c,i

hugo larochelle

universit  e de sherbrooke

hugo.larochelle@usherbrooke.ca

hugo.larochelle@usherbrooke.ca

c,i
hugo.larochelle@usherbrooke.ca
c,i

c
hugo.larochelle@usherbrooke.ca

d  epartement d   informatique
c,i
c,i
universit  e de sherbrooke
c,i
c,i

d  epartement d   informatique
hugo larochelle
universit  e de sherbrooke
c,i
c,i
c,i

     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) = exp (ps    f,s t(y, x))
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
pk
pk
pk
pk
pk
pk
pk
k=1 1yk=c   
     f (y, x) =  f (yk) = exp   b(l+1)
     f (y, x) =  f (yk) = exp   b(l+1)
     f (y, x) =  f (yk) = exp   b(l+1)
     f (y, x) =  f (yk) = exp   b(l+1)
k=1 1yk=c   
k=1 1yk=c   
k=1 1yk=c   
     f (y, x) =  f (yk) = exp   b(l+1)
k=1 1yk=c   
k=1 1yk=c   
     f (y, x) =  f (yk) = exp   b(l+1)
pk
pk
pk
pk
pk
pk
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
k=1 xk+1,i 1yk=c   
factor graph visualization
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
k=1 xk+1,i 1yk=c   
k=1 xk+1,i 1yk=c   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
pk 1
pk 1
pk 1
pk 1
pk 1
pk 1
pk 1
k=2 xk 1,i 1yk=c   
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
k=2 xk 1,i 1yk=c   
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
k=2 xk 1,i 1yk=c   
k=2 xk 1,i 1yk=c   
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
k=2 xk 1,i 1yk=c   
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
k=2 xk 1,i 1yk=c   
pk
pk
pk
pk
pk
pk
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
k=1 1yk=c 1yk+1=c0   
k=1 1yk=c 1yk+1=c0   
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
september 26, 2012
pk
pk
pk
pk
pk
pk
= observed
september 26, 2012
c,i
c,i
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
k=1 xk+1,i 1yk=c   
k=1 xk+1,i 1yk=c   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
pk 1
pk 1
pk 1
pk 1
pk 1
pk 1
    au(yk) = a(l+1,0)(xk)yk + 1k>1 a(l+1, 1)(xk 1)yk + 1k<k a(l+1,+1)(xk+1)yk
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    ap(yk, yk+1) = 11   k<k vyk,yk+1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    exp(a(l+1,0)(x3)y3) exp(a(l+1, 1)(x2)y3) exp(a(l+1,+1)(x4)y3) exp(vy3,y4)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5

topics: factor graph
    factor graphs better represent factors 
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
math for my slides    training crfs   .
abstract
= factor
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
math for my slides    training crfs   .
abstract
    au(yk) = a(l+1,0)(xk)yk + 1k>1 a(l+1, 1)(xk 1)yk + 1k<k a(l+1,+1)(xk+1)yk
    au(yk) = a(l+1,0)(xk)yk + 1k>1 a(l+1, 1)(xk 1)yk + 1k<k a(l+1,+1)(xk+1)yk
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    ap(yk, yk+1) = 11   k<k vyk,yk+1
    au(yk) = a(l+1,0)(xk)yk + 1k>1 a(l+1, 1)(xk 1)yk + 1k<k a(l+1,+1)(xk+1)yk
    ap(yk, yk+1) = 11   k<k vyk,yk+1
    exp(a(l+1,0)(x3)y3) exp(a(l+1, 1)(x2)y3) exp(a(l+1,+1)(x4)y3) exp(vy3,y4)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
     f (yk, yk+2)  f (yk, yk+1, yk+2)
    ap(yk, yk+1) = 11   k<k vyk,yk+1
    exp(a(l+1,0)(x3)y3) exp(a(l+1, 1)(x2)y3) exp(a(l+1,+1)(x4)y3) exp(vy3,y4)
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    x1 x2 x3 x4 x5
    exp(a(l+1,0)(x3)y3) exp(a(l+1, 1)(x2)y3) exp(a(l+1,+1)(x4)y3) exp(vy3,y4)
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5
    y1 y2 y3 y4 y5

math for my slides    training crfs   .
abstract

math for my slides    training crfs   .

september 26, 2012

september 26, 2012

abstract

c,i
c,i

c,i

c,i

c,i
c,i

c,i

c,i

c,i

c,i

c,i

c,i

    this is less ambiguous:

2
2

2
2

2

2

2

factor graph 1

markov network

factor graph 2

?

?

belief propagation

3

   

   

s.t. zs=i

  s0!f (zs0)

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
    there are two types of message: 

   
  f!s(i) = xz2dom(f )
  f!s(i) = xz is unobs.
   
   
from a variable node (    ) to its neighbor factor nodes (    ):

topics: belief propagation, message passing
    factor graphs better represent the computations needed to 
do id136
   
    we can write the forward-backward algorithm seen before into a general message 
passing form
   
   
  s!f (i) = yf02ne(s)\f
   

  f!s(i) = xz2dom(f )|zs=i
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )|zs=i
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )|zs=i
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz2dom(f )|zs=i
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f

  f!s(i) = xz2dom(f )
   
from a factor node (    ) to its neighbor variable nodes (    ):
  f!s(i) = xz is unobs.

  f!s(i) = xz2dom(f )|zs=i

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s

  s!f (i) = yf02ne(s)\f

  f0!s(zi)
  f0!s(zi)

  f0!s(zi)

  s0!f (zs0)

  f!s(i) = xz2dom(f )|zs=i

 f (z) ys02ne(f )\s

  s0!f (zs0)

  f0!s(zi)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  f0!s(i)

and zs=i

and zs=i

s.t. zs=i

  f0!s(zi)

  s0!f (zs0)

-

-

  s0!f (zs0)
  s0!f (zs0)

  s!f (i) = yf02ne(s)\f

   

   
topics: belief propagation, message passing
    example: our (simpli   ed) linear chain crf
   

   

   

4

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f ( zs0)

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
belief propagation
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f0!s(cid:0)i(cid:0)
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
    y1 y2 y3 x1 x2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  s0!f (zs0)

  s0!f (zs0)

  f0!s( i)

  f0!s(i)

  f0!s(i)

=    2( y3) )

=    1( y2) )

  s0!f (zs0)

  f0!s(i)

and zs=i

and zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

   

   
    y1 y2 y3 x1 x2
    1
   
   
   

    y1 y2 y3 x1 x2
( au( y1)) e
   
   
( au( y2))
    y1 y2 y3 x1 x2

1 exp(au(y2))

   

    y1 y2 y3 x1 x2

    1 exp(au(y1)) exp(au(y1)) py1

    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2

   
1 exp(au(y2))
   

1 exp(au(y2))

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
4

   

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i
  s0!f (zs0)

  s0!f (zs0)

  s0!f ( zs0)

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

   
topics: belief propagation, message passing
    example: our (simpli   ed) linear chain crf
   

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
belief propagation
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f0!s(cid:0)i(cid:0)
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1
( au( y1)) e
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

   
1 exp(au(y2))
   

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

  f0!s( i)

  f0!s(i)

  f0!s(i)

=    2( y3) )

=    1( y2) )

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

  f0!s(i)

  f0!s(i)

and zs=i

and zs=i

and zs=i

s.t. zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

   

   

   

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
4

   

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

  s0!f (zs0)

and zs=i
  s0!f (zs0)

  s0!f (zs0)

  s0!f ( zs0)

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
belief propagation
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
topics: belief propagation, message passing
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f (i) = yf02ne(s)\f
  f0!s(i)
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
  s!f (i) = yf02ne(s)\f
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1
( au( y1)) e
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

   
1 exp(au(y2))
   

    1 exp(au(y1)) exp(au(y1)) py1

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

  f0!s( i)

  f0!s(i)

  f0!s(i)

=    2( y3) )

=    1( y2) )

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

  f0!s(i)

  f0!s(i)

and zs=i

and zs=i

s.t. zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
4

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

  f0!s(i)

  s0!f (zs0)

  s0!f (zs0)

and zs=i
  s0!f (zs0)

  s0!f (zs0)

  s0!f ( zs0)

    1 exp(au(y1)) exp(au(y1)) py1

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
belief propagation
   
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
   
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
topics: belief propagation, message passing
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
  f0!s(i)
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
  s!f (i) = yf02ne(s)\f
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
   
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1
( au( y1)) e
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

  f0!s( i)

  f0!s(i)

  f0!s(i)

=    2( y3) )

=    1( y2) )

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

  f0!s(i)

and zs=i

and zs=i

and zs=i

s.t. zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

   

   

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
4

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

and zs=i
  s0!f (zs0)

  s0!f (zs0)

  s0!f ( zs0)

    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
belief propagation
   
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
topics: belief propagation, message passing
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
  f0!s(i)
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
  s!f (i) = yf02ne(s)\f
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
   
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1
( au( y1)) e
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

  f0!s( i)

  f0!s(i)

  f0!s(i)

=    2( y3) )

=    1( y2) )

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

  f0!s(i)

and zs=i

and zs=i

and zs=i

s.t. zs=i

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

   

   

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

}

9

|

2

{

r

   

4

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f (zs0)

  s0!f ( zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

1
and zs=i
  s0!f (zs0)
=
u

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
  f!s(i) = xz2dom(f )
  f!s( i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
belief propagation
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
   
   
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
topics: belief propagation, message passing
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
   
   
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
)
  f0!s(i)
x
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
  s!f (i) = yf02ne(s)\f
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
   
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
  s0!f (zs0)
u

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

u
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

 
{

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

r

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

   

   

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

=    2( y3) )

=    1( y2) )

 

|

|

e

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

(

  f0!s(i)

h

and zs=i

and zs=i

and zs=i

s.t. zs=i

,

j

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

   

   

   

>i

  s!f (i) = yf02ne(s)\f

  f0!s(i)

p

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

}

9

|

2

{

r

   

4

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f ( zs0)

  s0!f (zs0)
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

1
and zs=i
  s0!f (zs0)
=
u

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s( i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
belief propagation
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
   
   
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s( i) = xz is unobs.
  f!s(i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
topics: belief propagation, message passing
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
   
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
   
x
  s!f (i) = yf02ne(s)\f
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
  s!f (i) = yf02ne(s)\f
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
   
    1 exp(au(y1)) exp(au(y1)) py1
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
    1 exp(au(y1)) exp(au(y1)) py1
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
   
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
  s0!f (zs0)
u

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

u
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

  s0!f (zs0)
  s0!f (zs0)

 
{

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

1 exp(au(y2))
1 exp(au(y2))

r

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

   

   

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

=    2( y3) )

=    1( y2) )

 

|

|

e

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

1 exp(au(y2))

(

  f0!s(i)

  f0!s(i)

h

and zs=i

and zs=i

and zs=i

s.t. zs=i

,

j

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

>i

  s!f (i) = yf02ne(s)\f

  f0!s(i)

p

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

}

9

|

2

{

r

   

4

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

and zs=i

i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f ( zs0)

  s0!f (zs0)
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

1
and zs=i
  s0!f (zs0)
=
u

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s( i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
belief propagation
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s0!f (zs0)
   
   
   
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s( i) = xz is unobs.
  f!s(i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
topics: belief propagation, message passing
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
   
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
   
x
  s!f (i) = yf02ne(s)\f
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
   
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
   
1 exp(au(y2))
    1 exp(au(y1)) exp(au(y1)) py1
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
1 exp(au(y2))
r
   
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
  f0!s(i)
  s0!f (zs0)
u

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

u
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

  s0!f (zs0)
  s0!f (zs0)

 
{

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

1 exp(au(y2))
1 exp(au(y2))

    y1 y2 y3 x1 x2

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

   

   

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

=    2( y3) )

=    1( y2) )

 

|

|

e

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

(

  f0!s(i)

  f0!s(i)

h

and zs=i

and zs=i

and zs=i

s.t. zs=i

,

j

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

>i

  s!f (i) = yf02ne(s)\f

  f0!s(i)

p

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

}

9

|

2

{

r

   

4

   

   

   

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

and zs=i

i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i
s.t. zs=i

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f ( zs0)

  s0!f (zs0)
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

1
and zs=i
  s0!f (zs0)
=
u

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s( i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
belief propagation
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s0!f (zs0)
   
   
   
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s( i) = xz is unobs.
  f!s(i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
topics: belief propagation, message passing
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
    example: our (simpli   ed) linear chain crf
   
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
   
x
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    1 exp(au(y1)) exp(au(y1)) py1
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
   
1 exp(au(y2))
    1 exp(au(y1)) exp(au(y1)) py1
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
1 exp(au(y2))
r
   
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

u
  f0!s(i)
  s0!f (zs0)
u

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

  s0!f (zs0)
  s0!f (zs0)

 
{

  s0!f (zs0)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

1 exp(au(y2))
1 exp(au(y2))

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

   

   

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

=    2( y3) )

=    1( y2) )

 

|

|

e

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

(

  f0!s(i)

  f0!s(i)

  f0!s(i)

h

and zs=i

and zs=i

and zs=i

s.t. zs=i

,

j

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

>i

  s!f (i) = yf02ne(s)\f

  f0!s(i)

p

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

}

9

|

2

{

r

   

4

   

   

   

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

and zs=i

and zs=i

i

s.t. zs=i

s.t. zs=i

and zs=i
s.t. zs=i

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f ( zs0)

  f0!s(i)
s.t. zs=i

s.t. zs=i
  s0!f (zs0)

  s0!f (zs0)
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

1
and zs=i
  s0!f (zs0)
=
u

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s( i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f ( z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
belief propagation
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s0!f (zs0)
   
   
   
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s( i) = xz is unobs.
  f!s(i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s0!f (zs0)
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
topics: belief propagation, message passing
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    example: our (simpli   ed) linear chain crf
   
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
   
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
   
)
1 exp(au(y2))
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
   
x
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    1 exp(au(y1)) exp(au(y1)) py1
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
   
1 exp(au(y2))
    1 exp(au(y1)) exp(au(y1)) py1
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
1 exp(au(y2))
r
   
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

u
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
  s0!f (zs0)
u

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

  s0!f (zs0)
  s0!f (zs0)

 
{

  s0!f (zs0)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

1 exp(au(y2))
1 exp(au(y2))

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

   

   

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

=    2( y3) )

=    1( y2) )

 

|

|

e

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

(

  f0!s(i)

  f0!s(i)

  f0!s(i)

h

and zs=i

and zs=i

and zs=i

,

j

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

>i

  s!f (i) = yf02ne(s)\f

  f0!s(i)

p

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
p

|

r

p

j

  s0!f (zs0)
p

and zs=i

s.t. zs=i

}

}

x
w

=
x

4

   

   

   

   

   

   

   

   

   

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

and zs=i

and zs=i

and zs=i

i

j

  

s.t. zs=i

s.t. zs=i

  f0!s(i)

and zs=i
s.t. zs=i

j
,

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

  f0!s(i)
  f0!s(i)

j
=

}

  s0!f ( zs0)

  f0!s(i)
s.t. zs=i

    y1 y2 y3 x1 x2

s.t. zs=i
  s0!f (zs0)

  s0!f (zs0)
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

  f0!s(i)
   

  f!s(i) = xz is unobs.

 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  s!f(cid:0)i(cid:0)(cid:0) yf02ne(s)\f

  f!s(cid:0)i(cid:0)(cid:0) xz2dom(f )
 f(cid:0)z(cid:0) ys02ne(f )\s
  f!s( i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f ( z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
belief propagation
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s0!f (zs0)
   
   
   
  f!s(cid:0)i(cid:0)(cid:0) xz is unobs.
 f(cid:0)z(cid:0) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  f!s( i) = xz is unobs.
  f!s(i) = xz is unobs.
 f ( z) ys02ne(f )\s
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
  s0!f (zs0)
   
  s!f (i) = yf02ne(s)\f
  s0!f (zs0)
  f!s(i) = xz2dom(f )
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
topics: belief propagation, message passing
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    1 exp(au(y1)) exp(au(y1)) py1
    example: our (simpli   ed) linear chain crf
   
   
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
  s!f ( i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
   
exp(au(y2))   1(y2) py2
  f0!s(cid:0)i(cid:0)
   
  f!s(i) = xz is unobs.
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
1 exp(au(y2))
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
}
exp(au(y2))   1(y2) py2
   
)
1 exp(au(y2))
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
   
x
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
   
...
  f!s(i) = xz2dom(f )
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
    1 exp(au(y1)) exp(au(y1)) py1
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
    y1 y2 y3 x1 x2
and zs=i
r
    1 exp(au(y1)) exp(au(y1)) py1
  s!f (i) = yf02ne(s)\f
    y1 y2 y3 x1 x2
/2
    (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) py1(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y1(cid:0)(cid:0) ap(cid:0)y1, y2(cid:0)(cid:0) (cid:0) (cid:0)    1(cid:0)y2(cid:0)(cid:0)
( au( y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
   
    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
  s!f (i) = yf02ne(s)\f
  s!f (i) = yf02ne(s)\f
x
    1
( au( y1)) e
   
1 exp(au(y2))
    1 exp(au(y1)) exp(au(y1)) py1
   
  f!s(i) = xz is unobs.
 f (z) ys02ne(f )\s
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) (cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0)   1(cid:0)y2(cid:0) py2(cid:0)(cid:0)(cid:0)(cid:0)au(cid:0)y2(cid:0)(cid:0) ap(cid:0)y2, y3(cid:0)(cid:0)   1(cid:0)y2(cid:0) (cid:0) (cid:0)    2(cid:0)y3(cid:0)(cid:0)
( au( y2))   1( y2) py2
exp(au(y2))   1(y2) py2
1 exp(au(y2))
r
   
exp(au(y2))   1(y2) py2
    1 exp(au(y1)) exp(au(y1)) py1
   
   
( au( y2))
   
 f (z) ys02ne(f )\s
  f!s(i) = xz2dom(f )
exp(au(y2))   1(y2) py2
    y1 y2 y3 x1 x2
   
1 exp(au(y2))
   
  s!f (i) = yf02ne(s)\f
    1 exp(au(y1)) exp(au(y1)) py1
    1 exp(au(y1)) exp(au(y1)) py1
 f (z) ys02ne(f )\s
  f!s(i) = xz is unobs.
exp(au(y2))   1(y2) py2
exp(au(y2))   1(y2) py2

u
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  f0!s(i)
  s0!f (zs0)
}
x
u
r
/2
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

( au( y1) + ap( y1, y2)) (
  f0!s(i)
  s0!f (zs0)
( au( y2) + ap( y2, y3))   1( y2) (

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  s0!f (zs0)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
  s0!f (zs0)

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
  f0!s(i)

   
1 exp(au(y2))
   

2
x
{

u
exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
x

1
and zs=i
  s0!f (zs0)
=
u

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

    y1 y2 y3 x1 x2

=
x

  s0!f (zs0)
  s0!f (zs0)

 
{

  s0!f (zs0)
exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

 
=

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )
and zs=i

 
=

1
=

u
x

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

2

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

1 exp(au(y2))
1 exp(au(y2))

r

  s0!f (zs0)

  s0!f (zs0)

  s0!f (zs0)

1 exp(au(y2))

   

   

>i

   

{

>i

  f0!s( i)

  f0!s(i)

  f0!s(i)

u

u

u

j
=

=    2( y3) )

=    1( y2) )

u

u

u

u

 

x

|

|

e

|

e

  s0!f (zs0)

1 exp(au(y2))

1 exp(au(y2))

(

(

)

  f0!s(i)

  f0!s(i)

  f0!s(i)

h

h

and zs=i

and zs=i

and zs=i

,

j

j

i

i

i

i

i

t

i

i

i

i

i

t

and zs=i

and zs=i

s.t. zs=i

s.t. zs=i

and zs=i

and zs=i

   

   

   

>i

9

w
9

|

2

x

2

{

{
=

)

x
r

(

   

r

   

  s!f (i) = yf02ne(s)\f

  f0!s(i)

}

|

p

 

,

i

{

   

   

e
x
p
x
p
e
x
p
1
e
x
p
e
x
p
e
x
p
  f!s(i) = xz is unobs.

 f (z) ys02ne(f )\s

  s0!f (zs0)

5

and zs=i

 f (z) ys02ne(f )\s
  s!f (i) = yf02ne(s)\f

  f0!s(i)

  s!f (i) = yf02ne(s)\f

  f0!s(i)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

  f!s(i) = xz is unobs.
(loopy) belief propagation

and zs=i

   

   

    y1 y2 y3 x1 x2

topics: belief propagation, message passing
    on a linear chain graph, belief propagation is the same a 
    y1 y2 y3 x1 x2
    1 exp(au(y1)) exp(au(y1)) py1
forward-backward
   
    forward pass of message passing computes the
       k(yk+1)  k(yk 1)
    backward pass of message passing computes the 

    1 exp(au(y1)) exp(au(y1)) py1
exp(au(y2))   1(y2) py2

   
       k(yk+1)  k(yk 1)

1 exp(au(y2))

1 exp(au(y2))

exp(au(y2))   1(y2) py2

    for numerical stability, passing log-messages is preferred 
    can do id136 on other types of structures

    belief propagation is also exact on arbitrary trees
    on a graph with loops, (loopy-)belief propagation can be used to do approximate 

id136 (but can divergence, if not careful)

    many general purpose libraries are publicly available

c

c,i

pk
     f (y, x) =  f (yk) = exp   b(l+1)
k=1 1yk=c   
pk
k=1 xk,i 1yk=c   
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
pk
linear chain crf
     f (y, x) =  f (yk, xk 1,i) = exp   w (l+1, 1)
k=2 xk 1,i 1yk=c   
pk
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
pk 1
     f (y, x) =  f (yk, xk,i) = exp   w (l+1,0)
k=1 xk,i 1yk=c   
pk
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, xk+1,i) = exp   w (l+1,+1)
k=1 xk+1,i 1yk=c   
pk 1
k=1 1yk=c 1yk+1=c0   
     f (y, x) =  f (yk, yk+1) = exp   vc,c0 pk 1

topics: other variations on linear chain crf
    we could add lateral connections between labels that are at 2 
positions away

    we could add lateral connections for triplets 
of labels

     f (yk, yk+2)  f (yk, yk+1, yk+2)

     f (yk, yk+2)  f (yk, yk+1, yk+2)

c,i

c,i

c,i

c,i

6

    the idea is to add connections between things to model their 
dependency more directly

    the connectivity can even change between examples

    v w(l+1) b(l+1)

p(y|x) = exp  kxk=1
kxk=2

a(l+1,0)(xk)yk +

general crf

vyk,yk+1+

a(l+1,+1)(xk+1)yk! /z(x)
topics: crfs in general
    we don   t have to restrict the crf structure to linear chains

a(l+1, 1)(xk 1)yk +

k 1xk=1
k 1xk=1

    w(l+1, 1) w(l+1,+1) w(l+1,0) b(l+1)

7

p(y|x) =

1

z(x)yf

 f (y, x)

grid structure
(pixels in image)

     f (y, x) =  f (yk, xk 1) = exp a(l+1, 1)(xk 1)c 1yk=c 
     f (y, x) =  f (yk, xk+1) = exp a(l+1,+1)(xk+1)c 1yk=c 
     f (y, x) =  f (yk, xk) = exp a(l+1,0)(xk)c 1yk=c 
     f (y, x) =  f (yk, yk+1) = exp vc,c0 1yk=c 1yk+1=c0 

    we could also have n-ary factors, with n>2

general pair-wise structure
(webpages sharing a link)

exp(au(y1) + ap(y1, y2)) ( =    1(y2) )

8

exp(au(y2) + ap(y2, y3))   1(y2) ( =    2(y3) )

1 exp(au(y2))

    1 exp(au(y1)) exp(au(y1)) py1

(loopy) belief propagation

exp(au(y2))   1(y2) py2
   
       k(yk+1)  k(yk 1)
topics: crfs in general
=     pf
    marginals can be approximated with:
    @ log p(y(t)|x(t))
exp(log  f (yk)+pf02ne(k)\f log   f0!k(yk))
    p(yk|x) =
exp(log  f (y0k)+pf02ne(k)\f log   f0!k(y0k))
py0k

@    log  f (y(t), x(t))   eyhpf

@   

@

    in general, an approximated marginal is computed by
1. summing all the log-factors that involve only the yk variables of interest
2. summing all the log-messages coming into the yk variables from other factors
3. exponentiating
4. renormalizing

@

@    log  f (y, x(t))  x(t)i   

