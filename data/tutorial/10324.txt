building end-to-end dialogue systems

using generative hierarchical neural network models

iulian v. serban*, alessandro sordoni*, yoshua bengio1*, aaron courville* and joelle pineau   

{iulian.vlad.serban,alessandro.sordoni,yoshua.bengio,aaron.courville} at umontreal.ca

*department of computer science and operations research, universit  e de montr  eal, montreal, canada
   school of computer science, mcgill university, montreal, canada jpineau at cs.mcgill.ca

6
1
0
2

 
r
p
a
6

 

 
 
]
l
c
.
s
c
[
 
 

3
v
8
0
8
4
0

.

7
0
5
1
:
v
i
x
r
a

abstract

we investigate the task of building open domain, conversa-
tional dialogue systems based on large dialogue corpora us-
ing generative models. generative models produce system
responses that are autonomously generated word-by-word,
opening up the possibility for realistic,    exible interactions.
in support of this goal, we extend the recently proposed hier-
archical recurrent encoder-decoder neural network to the di-
alogue domain, and demonstrate that this model is compet-
itive with state-of-the-art neural language models and back-
off id165 models. we investigate the limitations of this and
similar approaches, and show how its performance can be im-
proved by id64 the learning from a larger question-
answer pair corpus and from pretrained id27s.

introduction

dialogue systems, also known as interactive conversational
agents, virtual agents and sometimes chatterbots, are used
in a wide set of applications ranging from technical sup-
port services to language learning tools and entertainment
(young et al. 2013; shawar and atwell 2007). dialogue sys-
tems can be divided into goal-driven systems, such as tech-
nical support services, and non-goal-driven systems, such as
language learning tools or computer game characters. our
current work focuses on the second case, due to the avail-
ability of large corpora of this type, though the model may
eventually prove useful for goal-driven systems also.

perhaps the most successful approach to goal-driven sys-
tems has been to view the dialogue problem as a partially
observable markov decision process (pomdp) (young et al.
2013). unfortunately, most deployed dialogue systems use
hand-crafted features for the state and action space repre-
sentations, and require either a large annotated task-speci   c
corpus or a horde of human subjects willing to interact with
the un   nished system. this not only makes it expensive and
time-consuming to deploy a real dialogue system, but also
limits its usage to a narrow domain. recent work has tried
to push goal-driven systems towards learning with few ex-
amples using constraints on the pomdp (gasic et al. 2013)
as well as learning the observed features themselves with
neural network models (henderson, thomson, and young

1y.b. is a cifar senior fellow

copyright c(cid:13) 2015, association for the advancement of arti   cial
intelligence (www.aaai.org). all rights reserved.

2014), yet such approaches still require either hand-crafted
features or large corpora of annotated task-speci   c simu-
lated conversations.

on the other end of the spectrum are the non-goal-
driven systems (ritter, cherry, and dolan 2011; banchs
and li 2012; ameixa et al. 2014). most recently sor-
doni et al. (2015b) and shang et al. (2015) have drawn in-
spiration from the use of neural networks in natural lan-
guage modeling and machine translation tasks (cho et al.
2014). there are several motivations for developing non-
goal-driven systems. first, they may be deployed directly
for tasks which do not naturally exhibit a directly measur-
able goal (e.g. language learning) or simply for entertain-
ment. second, if they are trained on corpora related to the
task of a goal-driven dialogue system (e.g. corpora which
cover conversations on similar topics) then these models
can be used to train a user simulator, which can then train
the pomdp models discussed earlier (young et al. 2013;
pietquin and hastie 2013). this would alleviate the expen-
sive and time-consuming task of constructing a large-scale
task-speci   c dialogue corpus. in addition to this, the fea-
tures extracted from the non-goal-driven systems may be
used to expand the state space representation of pomdp
models (singh et al. 2002). this can help generalization to
dialogues outside the annotated task-speci   c corpora.

our contribution is in the direction of end-to-end train-
able, non-goal-driven systems based on generative proba-
bilistic models. we de   ne the generative dialogue problem
as modeling the utterances and interactive structure of the
dialogue. as such, we view our model as a cognitive sys-
tem, which has to carry out natural language understand-
ing, reasoning, decision making and natural language gen-
eration in order to replicate or emulate the behavior of the
agents in the training corpus. our approach differs from
previous work on learning dialogue systems through inter-
action with humans (young et al. 2013; gasic et al. 2013;
cantrell et al. 2012; mohan and laird 2014), because it
learns off-line through examples of human-human dialogues
and aims to emulate the dialogues in the training corpus in-
stead of maximize a task-speci   c objective function. con-
trary to explanation-based learning (mohan and laird 2014)
and rule-based id136 systems (langley et al. 2014), our
model does not require a prede   ned state or action space
representation. these representations are instead learned

directly from the corpus examples together with id136
mechanisms, which map dialogue utterances to dialogue
states, and action generation mechanisms, which map dia-
logue states to dialogue acts and stochastically to response
utterances. we believe that training such a model end-to-end
to minimize a single objective function, and with minimum
reliance on hand-crafted features, will yield superior perfor-
mance in the long run. furthermore, we focus on models
which can be trained ef   ciently on large datasets and which
are able to maintain state over long conversations.

we experiment with the well-established recurrent neural
networks (id56) and id165 models. in particular, we adopt
the hierarchical recurrent encoder-decoder (hred) (sor-
doni et al. 2015a) and demonstrate that it is competitive with
other models in the literature. we extend the model archi-
tecture to better suit the dialogue task. we show that perfor-
mance can be substantially improved by id64 from
pretrained id27s and by pretraining the model
on a larger question-answer pair (q-a) corpus. to carry out
experiments, we introduce the movietriples dialogue dataset
based on movie scripts.

related work

modeling conversations on micro-blogging websites with
generative probabilistic models was    rst proposed by ritter
et al. (2011). they view the response generation problem
as a translation problem, where a post needs to be translated
into a response. generating responses was found to be con-
siderably more dif   cult than translating between languages,
likely due to the wide range of plausible responses and lack
of phrase alignment between the post and the response.

later, shang et al. (2015) proposed to use the recur-
rent neural network framework for generating responses on
micro-blogging websites. this was followed up by sordoni
et al. (2015b), who extended the framework from status-
reply pairs to triples of three consecutive utterances.

to the best of our knowledge, banchs et al. (2012) were
the    rst to suggest using movie scripts to build dialogue sys-
tems. conditioned on one or more utterances, their model
searches a database of movie scripts and retrieves an appro-
priate response. this was later followed up by ameixa et
al. (2014), who demonstrated that movie subtitles could be
used to provide responses to out-of-domain questions using
an information retrieval system.

models

we consider a dialogue as a sequence of m utterances
d = {u1, . . . , um} involving two interlocutors. each
um contains a sequence of nm tokens,
i.e. um =
{wm,1, . . . , wm,nm}, where wm,n is a random variable tak-
ing values in the vocabulary v and representing the token at
position n in utterance m. the tokens represent both words
and speech acts, e.g. pause and end of turn tokens. a gen-
erative model of dialogue parameterizes a id203 dis-
tribution p - governed by parameters    - over the set of all
possible dialogues of arbitrary lengths. the id203 of a

dialogue d can be decomposed:

m(cid:89)

p  (u1, . . . , um ) =

m(cid:89)

nm(cid:89)

=

p  (um|u<m),

m=1

p  (wm,n|wm,<n, u<m),

(1)

m=1

n=1

u<m = {u1, . . . , um   1}, wm,<n = {wm,1, . . . , wm,n   1},
i.e. the tokens preceding n in the utterance um. the task is
analogous to id38, with the critical difference
that speech acts are included as separate tokens. sampling
from the model can be performed as in standard language
modeling: sampling one word at a time from the conditional
distribution p  (wm,n|wm,<n, u<m) conditioned on the pre-
viously sampled words.

using standard id165s to compute joint probabilities
over dialogues, e.g. computing id203 tables for each
token given the n preceding tokens, suffers from the curse of
dimensionality and is intractable for any realistic vocabulary
size. to overcome this, bengio et al. (2003) proposed a dis-
tributed (dense) vector representation of words, called word
embeddings, which parameterizes p  (wm,n|wm,<n, u<m)
as a smooth function using a neural network. by means
of such distributed representations, the recurrent neural net-
work (id56) based language model (mikolov et al. 2010)
has pushed state-of-the-art performance by learning long n-
gram contexts while avoiding data sparsity issues. overall,
id56s have performed well on a variety of nlp tasks such
as machine translation (cho et al. 2014; sutskever, vinyals,
and le 2014; bahdanau, cho, and bengio 2015) and infor-
mation retrieval (sordoni et al. 2015a).
recurrent neural network
a recurrent neural network (id56) models an input se-
quence of tokens {w1, . . . , wn} using the recurrence:

hn = f (hn   1, wn),

(2)
where hn     rdh is called a recurrent, or hidden, state and
acts as a vector representation of the tokens seen up to posi-
tion n. in particular, the last state hn may be viewed as an
order-sensitive compact summary of all the tokens. in lan-
guage modeling tasks, the context information encoded in
hn is used to predict the next token in the sentence:

p  (wn+1 = v|w   n) =

exp (g(hn, v))
v(cid:48) exp (g(hn, v(cid:48)))

.

the functions f and g are typically de   ned as:

hn,

g(hn, v) = ot
wn

f (hn   1, wn) = tanh (hhn   1 + iwn ) ,

(3)
(4)
the matrix i     rdh  |v | contains the input word embed-
dings, i.e. each column ij is a vector corresponding to token
j in the vocabulary v . due to the size of the model vocab-
ulary v , it is common to approximate the i matrix with a
low-rank decomposition, i.e. i = xe, where x     rdh  de
and e     rde  |v |, and de < dh. this approach has also

(cid:80)

figure 1: the computational graph of the hred architecture for a dialogue composed of three turns. each utterance is
encoded into a dense vector and then mapped into the dialogue context, which is used to decode (generate) the tokens in the
next utterance. the encoder id56 encodes the tokens appearing within the utterance, and the context id56 encodes the temporal
structure of the utterances appearing so far in the dialogue, allowing information and gradients to    ow over longer time spans.
the decoder predicts one token at a time using a id56. adapted from sordoni et al. (2015a).

the advantage that the embedding matrix e may separately
be bootstrapped (e.g. learned) from larger corpora. analo-
gously, the matrix o     rdh  |v | represents the output word
embeddings, where each possible next token is projected
into another dense vector and compared to the hidden state
hn. the id203 of seeing token v at position n + 1 in-
creases if its corresponding embedding vector ov is    near   
the context vector hn. the parameter h is called a recurrent
parameter, because it links hn   1 to hn. all parameters are
learned by maximizing the log-likelihood of the parameters
on a training set using stochastic id119.
hierarchical recurrent encoder-decoder
our work extends the hierarchical
recurrent encoder-
decoder architecture (hred) proposed by sordoni et
al. (2015a) for web query suggestion. in the original frame-
work, hred predicts the next web query given the queries
already submitted by the user. the history of past submitted
queries is considered as a sequence at two levels: a sequence
of words for each web query and a sequence of queries.
hred models this hierarchy of sequences with two id56s:
one at the word level and one at the query level. we make
a similar assumption, namely, that a dialogue can be seen
as a sequence of utterances which, in turn, are sequences of
tokens. a representation of hred is given in figure 1.

in dialogue, the encoder id56 maps each utterance to an
utterance vector. the utterance vector is the hidden state
obtained after the last token of the utterance has been pro-
cessed. the higher-level context id56 keeps track of past ut-
terances by processing iteratively each utterance vector. af-
ter processing utterance um, the hidden state of the context
id56 represents a summary of the dialogue up to and includ-

ing turn m, which is used to predict the next utterance um+1.
this hidden state can be interpreted as the continuous-valued
state of the dialogue system. the next utterance prediction is
performed by means of a decoder id56, which takes the hid-
den state of the context id56 and produces a id203 dis-
tribution over the tokens in the next utterance. the decoder
id56 is similar to the id56 language model (mikolov et al.
2010), but with the important difference that the prediction
is conditioned on the hidden state of the context id56. it can
be interpreted as the response generation module of the di-
alogue system. the encoder, context and decoder id56s all
make use of the gru hidden unit (cho et al. 2014). every-
where else we use the hyperbolic tangent as activation func-
tion. it is also possible to use the maxout activation func-
tion between the hidden state and the projected word em-
beddings of the decoder id56 (goodfellow et al. 2013). the
same encoder id56 and decoder id56 parameters are used
for every utterance in a dialogue. this helps the model gen-
eralize across utterances. further details of the architecture
are described by sordoni et al. (2015a).

for modeling dialogues, we expect the hred model to be
superior to the standard id56 model for two reasons. first,
because the context id56 allows the model to represent a
form of common ground between speakers, e.g. to represent
topics and concepts shared between the speakers using a dis-
tributed vector representation, which we hypothesize to be
important for building an effective dialogue system (clark
and brennan 1991). second, because the number of com-
putational steps between utterances is reduced. this makes
the objective function more stable w.r.t. the model parame-
ters, and helps propagate the training signal for    rst-order
optimization methods (sordoni et al. 2015a).

bidirectional hred
in hred, the utterance representation is given by the last
hidden state of the encoder id56. this architecture worked
well for web queries, but may be insuf   cient for dialogue
utterances, which are longer and contain more syntactic ar-
ticulations than web queries. for long utterances, the last
state of the encoder id56 may not re   ect important infor-
mation seen at the beginning of the utterance. thus, we
also experiment with a model where the utterance encoder
is a bidirectional id56. bidirectional id56s run two chains:
one forward through the utterance tokens and another back-
ward, i.e. reversing the tokens in the utterance. the forward
hidden state at position n summarizes tokens preceding po-
sition n and the backwards hidden state summarizes tokens
following position n.1 to obtain a    xed-length represen-
tation for the utterance, we summarize the information in
the forward and backward id56 hidden states by either: 1)
taking the concatenation of the last state of each id56 as
input to the context id56, or 2) applying l2 pooling over
the temporal dimension of each chain, and taking the con-
catenation of the two pooled states as input to the context
id56.2 the bidirectional structure will effectively introduce
additional short term dependencies, which has proven useful
in similar architectures (bahdanau, cho, and bengio 2015;
sutskever, vinyals, and le 2014). in experiments below, we
refer to this variant as hred-bidirectional.

id64 from id27s and
subtitles q-a
the commonsense knowledge that the dialogue interlocu-
tors share may be dif   cult to infer if the dataset is not
suf   ciently large.
therefore, our models may be im-
proved by learning id27s from larger corpora.
we choose to initialize our id27s e with
id973 (mikolov et al. 2013) trained on the google
news dataset containing about 100 billion words. the sheer
size of the dataset ensures that the embeddings contain rich
semantic information about each word.

to learn a good initialization point for all model param-
eters, instead of only the id27s, we can further
pretrain the model on a large non-dialogue corpus, which
covers similar topics and types of interactions between in-
terlocutors. one such corpus is the q-a subtle corpus con-
taining about 5.5m q-a pairs constructed from movie subti-
tles (ameixa et al. 2014). we construct an arti   cial dialogue
dataset by taking each {q, a} pair as a two-turn dialogue
d = {u1 = q, u2 = a} and use this to pretrain the model.

dataset

the movietriples dataset has been developed by expand-
ing and preprocessing the movie-dic dataset by banchs et

1the output of the bidirectional id56 is always based on the

utterance before the current utterance of the decoder id56.

an

over

as
n, where hn is the encoder id56 hidden

utterance um is

de   ned

(cid:113)

(cid:80)nm

pooling
n=1 h2

2l2
1/nm

state at position n, and nm is the length of the utterance.
3http://code.google.com/p/id97/

training validation

movies
triples
avg. tokens/triple
avg. unk/triple

484

196,308

53
0.97

65

24,717

53
1.22

test
65

24,271

55
1.19

table 1: statistics of the movietriples dataset.

al. (2012) to make it    t the generative dialogue modeling
framework. the dataset is available upon request. movie
scripts span a wide range of topics, contain long interactions
with few participants and relatively few spelling mistakes
and acronyms. as observed by forchini (2009):    movie
language can be regarded as a potential source for teach-
ing and learning spoken language features   . therefore, we
believe id64 a goal-driven spoken dialogue system
based on movie scripts will improve performance.

we used the python-based natural language toolkit nltk
(bird, klein, and loper 2009) to perform id121 and
named-entity recognition. all names and numbers were re-
placed with the <person> and <number> tokens respec-
tively (ritter, cherry, and dolan 2010). to reduce data spar-
sity further, all tokens were transformed to lowercase letters,
and all but the 10,000 most frequent tokens were replaced
with a generic <unk> token.
we then generated    triples    {u1, u2, u3}, i.e. dialogues
of three turns between two interlocutors a and b, for
which a emits a    rst utterance u1, b responds with u2
and a responds with a last utterance u3 (sordoni et al.
2015b). to capture the interactive dialogue structure, a spe-
cial end-of-utterance token is appended to all utterances and
a continued-utterance token between breaks in lines from
the same speaker. to avoid co-dependencies between triples
coming from the same movie, we    rst split the movies
into training, validation and test set, and then construct the
triples. statistics are reported in table 1.

experiments

we evaluate the different variants of our hred model, and
compare against several alternatives, including basic id165
models (goodman 2001), a standard (non-hierarchical)
id56 trained on the concatenation of the utterances in each
triple, and a context-sensitive model (dcgm-i) recently
proposed by sordoni et al. (2015b).

id74
accurate evaluation of a non-goal-driven dialogue sys-
tem is an open problem (galley et al. 2015; pietquin and
hastie 2013; schatzmann, georgila, and young 2005).
there is no well-established method for automatic evalua-
tion, and human-based evaluation is expensive. neverthe-
less, for probabilistic language models word perplexity is
a well-established performance metric (bengio et al. 2003;
mikolov et al. 2010), and has been suggested for generative
dialogue models previously (pietquin and hastie 2013). we

de   ne word perplexity:

(cid:32)

exp

    1
nw

n(cid:88)

n=1

(cid:33)

log p  (u n

1 , u n

2 , u n
3 )

,

(5)

2 , u n

1 , u n

3 }n

for a model with parameters   , dataset with n triples
{u n
n=1, and nw the number of tokens in the en-
tire dataset. lower perplexity is indicative of a better model.
perplexity explicitly measures the model   s ability to account
for the syntactic structure of the dialogue (e.g. turn-taking)
and the syntactic structure of each utterance (e.g. punctua-
tion marks). in dialogue, the distribution over the words in
the next utterance is highly multi-modal, e.g. there are many
possible answers, which makes perplexity particularly ap-
propriate because it will always measure the id203 of
regenerating the exact reference utterance.

we also consider the word classi   cation error (also known
as word error-rate). this is de   ned as the number of words
in the dataset the model has predicted incorrectly divided
by the total number of words in the dataset.4 each word
contributes either zero or 1/nw to the count, which means
that it is more robust to unlikely (e.g. unpredictable) words.
however, it is also less    ne-grained than word perplexity.
instead of measuring the whole distribution, it only mea-
sures the regions of high id203.

ultimately, we care about generating syntactically and
semantically coherent dialogues. for example, utterances
which are grammatically correct and re   ect the distribution
of topics in the corpus, and whole dialogues which re   ect
the interaction patterns and topical evolutions of the dia-
logues in the corpus. despite having been proposed be-
fore (pietquin and hastie 2013; schatzmann, georgila, and
young 2005). it is not clear how well word perplexity and
word classi   cation errors correlate with this goal. neverthe-
less, optimizing probabilistic models using word perplex-
ity has shown promising results in several machine learn-
ing tasks including id151 (auli et
al. 2013; sutskever, vinyals, and le 2014; bahdanau, cho,
and bengio 2015), id103 (hinton et al. 2012;
deng and li 2013) and image id134 (kiros,
salakhutdinov, and zemel 2014; vinyals et al. 2015). based
on these empirical    ndings, we expect to be able to discrim-
inate between models based on word perplexity, and to use
word classi   cation error and qualitative analysis of gener-
ated dialogues to understand the performance of the models
in depth.

training procedure
to train the neural network models, we optimized the log-
likelihood of the triples using the recently proposed adam
optimizer (kingma and ba 2014).5 our implementation re-
lied on the open-source python library theano (bastien et

4for a word prediction to be counted as correct, both the word

and its position in the utterance must be correct.

5we truncated all triples to have a maximum size of 80 tokens,
and could therefore apply id26 on the full token se-
quences.

al. 2012).6 the best hyperparameters of the models were
chosen by early stopping with patience on the validation set
perplexity (bengio 2012). we initialized the recurrent pa-
rameter matrices as orthogonal matrices, and all other pa-
rameters from a gaussian random distribution with mean
zero and standard deviation 0.01. for the baseline id56,
we tested hidden state spaces dh = 200, 300 and 400. for
hred we experimented with encoder and decoder hidden
state spaces of size 200, 300 and 400. based on prelimi-
nary results and due to gpu memory limitations, we limited
ourselves to size 300 when not id64 or bootstrap-
ping from id97, and to size 400 when id64
from subtle. preliminary experiments showed that the con-
text id56 state space at and above 300 performed similarly,
so we    xed it at 300 when not id64 or bootstrap-
ping from id97, and to 1200 when id64 from
subtle. for all models, we used id27 of size
400 when id64 from subtle and of size 300 other-
wise. to help generalization, we used the maxout activation
function, between the hidden state and the projected word
embeddings of the decoder id56, when not id64
and when id64 from id97. we used l2 pool-
ing for all hred models, except when id64 from
subtle since it appeared to perform slightly worse.

id64 id27s our embedding ma-
trix e was initialized using the publicly available 300 dim.
id97 embeddings trained on the google news cor-
pus (mikolov et al. 2013). special dialogue tokens, which
did not exist in the id97 embeddings, were initialized
from a gaussian random distribution as before. the training
procedure was carried out in two stages. first, we trained
each neural model with    xed id97 embeddings. dur-
ing this stage, we also trained the speech act and placeholder
tokens, together with tokens not covered by the original
id97 embeddings. in the second stage, we then trained
all parameters of each neural model until convergence.

id64 subtle we processed the subtle corpus
by following the same procedure as used for movietriples,
but treating the last utterances u3 as empty. the    nal sub-
tle corpus contained 5,503,741 q-a pairs, and a total of
93,320,500 tokens. when id64 from the subtle
corpus, we found that all models performed slightly better
when randomly initializing and learning the word embed-
dings from subtle compared to    xing the id27s
to those given by id97. for this reason, we do not
report results combining id64 from the subtle cor-
pus with id97 id27s.

the hred models were pretrained for approximately
four epochs on the subtle dataset, after which performance
did not appear to improve further. then, we    ne-tuned the
pretrained models on the movietriples dataset holding the
id27s    xed.

6the model implementations can be found on github:

https://github.com/julianser/hed-dlg
https://github.com/julianser/id56-lm.

model

perplexity

perplexity@u3

error-rate

error-rate@u3

backoff id165
modi   ed kneser-ney
absolute discounting id165
witten-bell discounting id165
id56
dcgm-i
hred
hred + id97
id56 + subtle
hred + subtle
hred-bi. + subtle

64.89
60.11
56.98
53.30

35.63    0.16
36.10    0.17
36.59    0.19
33.95    0.16
27.09    0.13
27.14    0.12
26.81    0.11

65.05
54.75
57.06
53.34

35.30    0.22
36.14    0.26
36.26    0.29
33.62    0.25
26.67    0.19
26.60    0.19
26.31    0.19

-
-
-
-

66.34%    0.06
66.44%    0.06
66.32%    0.06
66.06%    0.06
64.10%    0.06
64.10%    0.06
63.93%    0.06

-
-
-
-

66.32%    0.08
66.57%    0.10
66.32%    0.11
66.05%    0.09
64.07%    0.10
64.03%    0.10
63.91%    0.09

table 2: test set results computed on {u1, u2, u3} and solely on {u3} conditioned on {u1, u2}. standard deviations are shown
for all neural models. best performances are marked in bold.

reference (u1, u2)
u1: yeah , okay .
u2: well , i guess i     ll be going now .
u1: oh . <continued utterance> oh .
u2: what     s the matter , honey ?
u1: it     s the cheapest .
u2: then it     s the worst kind ?
u1: <person> ! what are you doing ?
u2: shut up ! c     mon .

map
i     ll see you tomorrow .

i don     t know .

no , it     s not .

target (u3)
yeah .

oh .

they     re all good , sir .

what are you doing here ?

what are you that crazy ?

table 3: map outputs for hred-bidirectional bootstrapped from subtle corpus. the    rst column shows the reference utter-
ances, where u1 and u2 are respectively the    rst and second utterance in the test triple. the second column shows the map
output produced by beam-search conditioned on u1 and u2. the third column shows the actual third utterance in the test triple.

empirical results

our results are presented in table 2. all neural models
beat state-of-the-art id165s models substantially w.r.t. both
word perplexity and word classi   cation error. without boot-
strapping, the id56 model performs similarly to the more
complex dcgm-i and hred models. this can be ex-
plained by the size of the dataset, which makes it easy for
the hred and dcgm-i model to over   t. the last four
lines of table 2 con   rm that id64 the model pa-
rameters achieves signi   cant gains in both measures. boot-
strapping from subtle is particularly useful since it allows a
gain of nearly 10 perplexity points compared to the hred
model without id64. we believe that this is be-
cause it trains all model parameters, unlike id64
from id97, which only trains the id27s.

in general, we    nd that the gains due to architectural
choice are smaller than those obtained by id64,
which can be explained by the fact that we are in a regime
of relatively little training data compared to other natural
language processing tasks, such as machine translation, and
hence we would expect the differences to grow with more
training data and longer dialogues. overall, the bidirectional
structure appears to capture and retain information from the
u1 and u2 utterances better than either the id56 and the
original hred model. this con   rms our earlier hypothesis,
and demonstrates the potential of hred for modeling long
dialogues.

of

use

also

beam-search

last utterance, u3, given the    rst

map outputs
the
for
we
considered
to approximate the most prob-
id56s (graves 2012)
able (map)
two
utterances, u1 and u2. map outputs are presented in
table 3 for hred-bidirectional bootstrapped from sub-
tle corpus. as shown here,
the model often produced
sensible answers.
however,
in fact,
the majority of
the predictions were generic, such as i don   t know or
i   m sorry. we observed the same phenomenon for the
id56 model, and similar observations can be inferred
by remarks in the recent literature (sordoni et al. 2015b;
vinyals and le 2015). to the best of our knowledge, we are
the    rst to emphasize and discuss it in details.7

there are several possible explanations for this behav-
ior. firstly, due to data scarcity, the models may only have
learned to predict the most frequent utterances. since the
dialogues are inherently ambiguous and multi-modal, pre-
dicting them accurately would require more data than other
natural language processing tasks. secondly, the majority
of tokens were punctuation marks and pronouns. since ev-
ery token is weighted equally during training, the gradient
signal of the neural networks is dominated by these punctu-

7after publishing the    rst draft of this paper, li et al. (2015) in-
vestigated this problem further and proposed to change the objec-
tive function at test time to also maximize the mutual information
between the generated utterance and the previous utterances.

ation and pronoun tokens. this makes it hard for the neural
networks to learn topic-speci   c embeddings and even harder
to predict diverse utterances. this suggests exploring neu-
ral architectures which explicitly separate semantic structure
from syntactic structure. finally, the context of a triple may
be too short. in that case, the models should bene   t from
longer contexts and by conditioning on other information
sources, such as semantic and visual information.

an important implication of this observation is that met-
rics based on map outputs (e.g. cosine similarity, id7,
levenshtein distance) will primarily favor models that out-
put the same number of punctuation marks and pronouns
as are in the test utterances, as opposed to similar semantic
content (e.g. nouns and verbs). this would be systemati-
cally biased and not necessarily in any way correlate with
the objective of producing appropriate responses. we there-
fore cannot justify the use of such metrics when the results
are known to lack diversity.

nevertheless, we also note that this problem did not occur
when we generated stochastic samples (as opposed to the
map outputs). in fact, the stochastic samples contained a
large variety of topic-speci   c words and often appeared to
maintain the topic of the conversation.

conclusion and future work

we have demonstrated that a hierarchical recurrent neu-
ral network generative model can outperform both id165
based models and baseline neural network models on the
task of modeling utterances and speech acts. to sup-
port our investigation, we introduced a novel dataset called
movietriples based on movie scripts, which are suitable for
modeling long, open domain dialogues close to human spo-
ken language. in addition to the recurrent hierarchical ar-
chitecture, we found two crucial ingredients for improving
performance: the use of a large external monologue corpus
to initialize the id27s, and the use of a large re-
lated, but non-dialogue, corpus in order to pretrain the recur-
rent net. this points to the need for larger dialogue datasets.
empirical performance of all models was measured us-
ing perplexity. while this is an established measure for
generative models, in the dialogue setting utterances may
be overwhelmed by many common words especially arising
from colloquial or informal exchanges. it may be fruitful
to investigate other measures of performance for genera-
tive dialogue systems. we also considered actual responses
produced by the model. the map outputs tended to pro-
duce somewhat generic, but conversationally acceptable, re-
sponses. stochastic samples from the model produced more
diverse dialogues.

future work should study models for full length dia-
logues, as opposed to triples, and model other speech acts,
such as interlocutors entering or leaving the dialogue and
executing actions. finally, our analysis of the model map
outputs suggests that it would be bene   cial to include longer
and additional context, including other modalities such as
audio and video.

acknowledgements

the authors acknowledge ibm research, nserc, canada
research chairs, nuance foundation, cifar and compute
canada for funding and resources. the authors thank ryan
lowe, laurent charlin and nissan pow for constructive
feedback. the authors thank rafael e. banchs for provid-
ing the movie-dic dataset, and luisa coheur for providing
the subtle dataset. the authors also thank the anonymous
aaai reviewers for their helpful feedback.

references

ameixa, d.; coheur, l.; fialho, p.; and quaresma, p. 2014.
luke, i am your father: dealing with out-of-domain requests
by using movies subtitles. in intelligent virtual agents, 13   
21.
auli, m.; galley, m.; quirk, c.; and zweig, g. 2013. joint
language and translation modeling with recurrent neural net-
works. in conference on empirical methods in natural lan-
guage processing, 1044   1054.
bahdanau, d.; cho, k.; and bengio, y. 2015. neural ma-
chine translation by jointly learning to align and translate. in
international conference on learning representations.
banchs, r. e., and li, h. 2012. iris: a chat-oriented dia-
logue system based on the vector space model. in proceed-
ings of the association for computational linguistics, system
demonstrations, 37   42.
banchs, r. e. 2012. movie-dic: a movie dialogue corpus
for research and development. in proceedings of the 50th an-
nual meeting of the association for computational linguistics,
203   207.
bastien, f.; lamblin, p.; pascanu, r.; bergstra, j.; goodfel-
low, i. j.; bergeron, a.; bouchard, n.; and bengio, y. 2012.
theano: new features and speed improvements. conference
on neural information processing systems, workshop on
deep learning and unsupervised id171.
bengio, y.; ducharme, r.; vincent, p.; and jauvin, c. 2003.
a neural probabilistic language model. journal of machine
learning research 3:1137   1155.
bengio, y. 2012. practical recommendations for gradient-
based training of deep architectures. in tricks of the trade,
second edition, volume 7700 of theoretical computer sci-
ence and general issues. springer-verlag. 437   478.
bird, s.; klein, e.; and loper, e. 2009. natural language
processing with python. o   reilly media.
cantrell, r.; talamadupula, k.; schermerhorn, p.; benton,
j.; kambhampati, s.; and scheutz, m. 2012. tell me when
and why to do it! run-time planner model updates via natu-
ral language instruction. in acm/ieee international confer-
ence on id176, 471   478.
cho, k.; van merrienboer, b.; gulcehre, c.; bahdanau, d.;
bougares, f.; schwenk, h.; and bengio, y. 2014. learn-
ing phrase representations using id56 encoder-decoder for
id151.
in conference on empirical
methods in natural language processing, 1724   1734.

clark, h. h., and brennan, s. e. 1991. grounding in
communication. perspectives on socially shared cognition
13(1991):127   149.
deng, l., and li, x. 2013. machine learning paradigms for
id103: an overview. audio, speech, and lan-
guage processing, ieee transactions on 21(5):1060   1089.
forchini, p. 2009. spontaneity reloaded: american face-
to-face and movie conversation compared.
in corpus lin-
guistics 2009. abstracts of the corpus linguistics conference,
118.
galley, m.; brockett, c.; sordoni, a.; ji, y.; auli, m.; quirk,
c.; mitchell, m.; gao, j.; and dolan, b. 2015. deltaid7:
a discriminative metric for generation tasks with intrinsi-
cally diverse targets. in proceedings of the annual meeting
of the association for computational linguistics and the in-
ternational joint conference on natural language processing
(short papers), 445   450.
gasic, m.; breslin, c.; henderson, m.; kim, d.; szummer,
m.; thomson, b.; tsiakoulis, p.; and young, s. 2013. on-
line policy optimisation of bayesian spoken dialogue sys-
tems via human interaction.
in ieee international confer-
ence on acoustics, speech and signal processing, 8367   8371.
goodfellow, i. j.; warde-farley, d.; mirza, m.; courville,
a.; and bengio, y. 2013. maxout networks. proceedings
of the international conference on machine learning 1319   
1327.
goodman, j. t. 2001. a bit of progress in language model-
ing extended version. machine learning and applied statis-
tics group microsoft research. technical report, msr-tr-
2001-72.
graves, a. 2012. sequence transduction with recurrent neu-
ral networks. in proceedings of the international conference
on machine learning, representation learning workshop.
henderson, m.; thomson, b.; and young, s. 2014. word-
based dialog state tracking with recurrent neural networks.
in annual meeting of the special interest group on discourse
and dialogue, 292   299.
hinton, g.; deng, l.; yu, d.; dahl, g. e.; mohamed, a.-r.;
jaitly, n.; senior, a.; vanhoucke, v.; nguyen, p.; sainath,
t. n.; et al. 2012. deep neural networks for acoustic model-
ing in id103: the shared views of four research
groups. signal processing magazine, ieee 29(6):82   97.
kingma, d., and ba, j. 2014. adam: a method for stochas-
tic optimization.
in international conference for learning
representations.
kiros, r.; salakhutdinov, r.; and zemel, r. 2014. multi-
modal neural language models. in proceedings of the inter-
national conference on machine learning, 595   603.
langley, p.; meadows, b.; gabaldon, a.; and heald, r.
2014. abductive understanding of dialogues about joint ac-
tivities. interaction studies 15(3):426   454.
li, j.; galley, m.; brockett, c.; gao, j.; and dolan, b. 2015.
a diversity-promoting objective function for neural conver-
sation models. corr abs/1510.03055.
mikolov, t.; kara     at, m.; burget, l.; cernock`y, j.; and
khudanpur, s.
2010. recurrent neural network based

in annual conference of the international

language model.
speech communication association, 1045   1048.
mikolov, t.; sutskever, i.; chen, k.; corrado, g. s.; and
dean, j. 2013. distributed representations of words and
phrases and their compositionality.
in advances in neural
information processing systems, 3111   3119.
mohan, s., and laird, j. 2014. learning goal-oriented hier-
archical tasks from situated interactive instruction. in aaai
conference on arti   cial intelligence, 387   394.
pietquin, o., and hastie, h. 2013. a survey on metrics for
the evaluation of user simulations. the knowledge engineer-
ing review 28(01):59   73.
ritter, a.; cherry, c.; and dolan, b. 2010. unsupervised
modeling of twitter conversations. in the annual conference
of the north american chapter of the association for compu-
tational linguistics, human language technologies, 172   180.
ritter, a.; cherry, c.; and dolan, w. b. 2011. data-driven
response generation in social media. in proceedings of the
empiricial methods in natural language, 583   593.
schatzmann, j.; georgila, k.; and young, s. 2005. quan-
titative evaluation of user simulation techniques for spoken
dialogue systems. in special interest group on discourse and
dialogue workshop on discourse and dialogue.
shang, l.; lu, z.; and li, h. 2015. neural responding
machine for short-text conversation. in association for com-
putational linguistics, 1577   1586.
shawar, b. a., and atwell, e. 2007. chatbots: are they
really useful? in ldv forum, volume 22, 29   49.
singh, s.; litman, d.; kearns, m.; and walker, m. 2002.
optimizing dialogue management with reinforcement learn-
ing: experiments with the njfun system. journal of arti   -
cial intelligence research 105   133.
sordoni, a.; bengio, y.; vahabi, h.; lioma, c.; simonsen,
j. g.; and nie, j.-y. 2015a. a hierarchical recurrent encoder-
decoder for generative context-aware query suggestion. in
proceedings of the acm international conference on informa-
tion and knowledge management, 553   562.
sordoni, a.; galley, m.; auli, m.; brockett, c.; ji, y.;
mitchell, m.; nie, j.-y.; gao, j.; and dolan, b. 2015b. a
neural network approach to context-sensitive generation of
conversational responses. in conference of the north ameri-
can chapter of the association for computational linguistics,
196   205.
sutskever, i.; vinyals, o.; and le, q. v. 2014. sequence
to sequence learning with neural networks. in advances in
neural information processing systems, 3104   3112.
vinyals, o., and le, q. 2015. a neural conversational
model. proceedings of the international conference on ma-
chine learning, deep learning workshop.
vinyals, o.; toshev, a.; bengio, s.; and erhan, d. 2015.
show and tell: a neural image caption generator.
in the
ieee conference on id161 and pattern recognition,
2155   2162.
young, s.; gasic, m.; thomson, b.; and williams, j. d.
2013. pomdp-based statistical spoken id71: a
review. ieee 101(5):1160   1179.

