6
1
0
2

 

b
e
f
9
2

 

 
 
]

g
l
.
s
c
[
 
 

2
v
3
9
7
2
0

.

1
1
5
1
:
v
i
x
r
a

published as a conference paper at iclr 2016

generating images from captions
with attention

elman mansimov, emilio parisotto, jimmy lei ba & ruslan salakhutdinov
department of computer science
university of toronto
toronto, ontario, canada
{emansim,eparisotto,rsalakhu}@cs.toronto.edu, jimmy@psi.utoronto.ca

abstract

motivated by the recent progress in generative models, we introduce a model that
generates images from natural language descriptions. the proposed model itera-
tively draws patches on a canvas, while attending to the relevant words in the de-
scription. after training on microsoft coco, we compare our model with several
baseline generative models on image generation and retrieval tasks. we demon-
strate that our model produces higher quality samples than other approaches and
generates images with novel scene compositions corresponding to previously un-
seen captions in the dataset.

1

introduction

statistical natural image modelling remains a fundamental problem in id161 and image
understanding. the challenging nature of this task has motivated recent approaches to exploit the
id136 and generative capabilities of deep neural networks. previously studied deep generative
models of images often de   ned distributions that were restricted to being either unconditioned or
conditioned on classi   cation labels. in real world applications, however, images rarely appear in
isolation as they are often accompanied by unstructured textual descriptions, such as on web pages
and in books. the additional information from these descriptions could be used to simplify the
image modelling task. moreover, learning generative models conditioned on text also allows a better
understanding of the generalization performance of the model, as we can create textual descriptions
of completely new scenes not seen at training time.
there are numerous ways to learn a generative model over both image and text modalities. one
approach is to learn a generative model of text conditioned on images, known as id134
(kiros et al., 2014a; karpathy & li, 2015; vinyals et al., 2015; xu et al., 2015). these models take
an image descriptor and generate unstructured texts using a recurrent decoder. in contrast, in this
paper we explore models that condition in the opposite direction, i.e.
taking textual descriptions
as input and using them to generate relevant images. generating high dimensional realistic images
from their descriptions combines the two challenging components of language modelling and image
generation, and can be considered to be more dif   cult than id134.
in this paper, we illustrate how sequential deep learning techniques can be used to build a conditional
probabilistic model over natural image space effectively. by extending the deep recurrent atten-
tion writer (draw) (gregor et al., 2015), our model iteratively draws patches on a canvas, while
attending to the relevant words in the description. overall, the main contributions of this work are
the following: we introduce a conditional aligndraw model, a generative model of images from
captions using a soft attention mechanism. the images generated by our aligndraw model are
re   ned in a post-processing step by a deterministic laplacian pyramid adversarial network (denton
et al., 2015). we further illustrate how our method, learned on microsoft coco (lin et al., 2014),
generalizes to captions describing novel scenes that are not seen in the dataset, such as    a stop sign
is    ying in blue skies    (see fig. 1).

1

published as a conference paper at iclr 2016

a stop sign is    ying in
blue skies.

a herd of elephants    y-
ing in the blue skies.

a toilet seat sits open in
the grass    eld.

a person skiing on sand
clad vast desert.

figure 1: examples of generated images based on captions that describe novel scene compositions that are
highly unlikely to occur in real life. the captions describe a common object doing unusual things or set in a
strange location.

2 related work

deep neural networks have achieved signi   cant success in various tasks such as image recognition
(krizhevsky et al., 2012), speech transcription (graves et al., 2013), and machine translation (bah-
danau et al., 2015). while most of the recent success has been achieved by discriminative models,
generative models have not yet enjoyed the same level of success. most of the previous work in
generative models has focused on variants of id82s (smolensky, 1986; salakhutdi-
nov & hinton, 2009) and id50 (hinton et al., 2006). while these models are very
powerful, each iteration of training requires a computationally costly step of mcmc to approximate
derivatives of an intractable partition function (id172 constant), making it dif   cult to scale
them to large datasets.
kingma & welling (2014), rezende et al. (2014) have introduced the variational auto-encoder
(vae) which can be seen as a neural network with continuous latent variables. the encoder is used
to approximate a posterior distribution and the decoder is used to stochastically reconstruct the data
from latent variables. gregor et al. (2015) further introduced the deep recurrent attention writer
(draw), extending the vae approach by incorporating a novel differentiable attention mechanism.
id3 (gans) (goodfellow et al., 2014) are another type of generative
models that use noise-contrastive estimation (gutmann & hyv  arinen, 2010) to avoid calculating
an intractable partition function. the model consists of a generator that generates samples using
a uniform distribution and a discriminator that discriminates between real and generated images.
recently, denton et al. (2015) have scaled those models by training conditional gans at each level
of a laplacian pyramid of images.
while many of the previous approaches have focused on unconditional models or models condi-
tioned on labels, in this paper we develop a generative model of images conditioned on captions.

3 model

our proposed model de   nes a generative process of images conditioned on captions. in particular,
captions are represented as a sequence of consecutive words and images are represented as a se-
quence of patches drawn on a canvas ct over time t = 1, ..., t . the model can be viewed as a part
of the sequence-to-sequence framework (sutskever et al., 2014; cho et al., 2014; srivastava et al.,
2015).

3.1 language model: the bidirectional attention id56

let y be the input caption, represented as a sequence of 1-of-k encoded words y = (y1, y2, ..., yn ),
where k is the size of the vocabulary and n is the length of the sequence. we obtain the caption sen-
tence representation by    rst transforming each word yi to an m-dimensional vector representation
hlang
, i = 1, .., n using the bidirectional id56. in a bidirectional id56, the two lstms (hochre-
i
iter & schmidhuber, 1997) with forget gates (gers et al., 2000) process the input sequence from both
forward and backward directions. the forward lstm computes the sequence of forward hidden
      
      
h lang
h lang
n ] , whereas the backward lstm computes the sequence of back-
states [
, ...,
      
      
      
h lang
h lang
h lang
ward hidden states [
n ]. these hidden states are then concatenated together
,
2
into the sequence hlang = [hlang
, ..., hlang

], 1     i     n.

, ...,
, hlang

      
h lang

      
h lang

      
h lang

= [

n ], with hlang

1

2

1

2

1

,

,

i

i

i

2

published as a conference paper at iclr 2016

figure 2: aligndraw model for generating images by learning an alignment between the input captions and
generating canvas. the caption is encoded using the bidirectional id56 (left). the generative id56 takes a
latent sequence z1:t sampled from the prior along with the dynamic caption representation s1:t to generate
the canvas matrix ct , which is then used to generate the    nal image x (right). the id136 id56 is used to
compute approximate posterior q over the latent sequence.

image model: the conditional draw network

3.2
to generate an image x conditioned on the caption information y, we extended the draw net-
work (gregor et al., 2015) to include caption representation hlang at each step, as shown in fig. 2.
the conditional draw network is a stochastic recurrent neural network that consists of a sequence
of latent variables zt     rd, t = 1, .., t , where the output is accumulated over all t time-steps. for
simplicity in notation, the images x     rh  w are assumed to have size h-by-w and only one color
channel.
unlike the original draw network where latent variables are independent spherical gaussians
n (0, i), the latent variables in the proposed aligndraw model have their mean and variance de-
t   1, except for p (z1) = n (0, i).
(cid:19)
pend on the previous hidden states of the generative lstm hgen
namely, the mean and variance of the prior distribution over zt are parameterized by:
t   1) = exp(cid:0) tanh(w  hgen
t   1)(cid:1),

p (zt|z1:t   1) = n

t   1) = tanh(w  hgen

  (hgen
  (hgen

t   1),   (hgen
t   1)

where w       rd  n, w       rd  n are the learned model parameters, and n is the dimensional-
ity of hgen
, the hidden state of the generative lstm. similar to (bachman & precup, 2015), we
have observed that the model performance is improved by including dependencies between latent
variables.
formally, an image is generated by iteratively computing the following set of equations for t =
1, ..., t (see fig. 2), with hgen

and c0 initialized to learned biases:

  (hgen

(cid:18)

t   1),

,

t

0

(cid:18)

(cid:19)

zt     p (zt|z1:t   1) = n

  (hgen

t   1),   (hgen
t   1)

t   1, hlang),

st = align(hgen
t = lstm gen(hgen
hgen
ct = ct   1 + write(hgen
  x     p (x| y, z1:t ) =

(cid:89)

),

t

t   1, [zt, st]),

p (xi | y, z1:t ) =

i

,

(cid:89)

i

bern(  (ct,i)).

the align function is used to compute the alignment between the input caption and intermediate
image generative steps (bahdanau et al., 2015). given the caption representation from the language
model, hlang = [hlang
n ], the align operator outputs a dynamic sentence representa-
tion st at each step through a weighted sum using alignment probabilities   t

, ..., hlang

, hlang

1

2

st = align(hgen

t   1, hlang) =   t

1hlang

1 +   t

2hlang

2 + ... +   t

1...n :
n hlang
n .

(1)

(2)
(3)
(4)
(5)

(6)

3

published as a conference paper at iclr 2016

(7)

the corresponding alignment id203   t
caption representation hlang and the current hidden state of the generative model hgen
t   1:

k for the kth word in the caption is obtained using the

(cid:16)

(cid:16)

exp

(cid:80)n

  t

k =

v(cid:62) tanh(u hlang

k + w hgen

t   1 + b)

i=1 exp

v(cid:62) tanh(u hlang

i

+ w hgen

t   1 + b)

(cid:17)

(cid:17) ,

where v     rl, u     rl  m, w     rl  n and b     rl are the learned model parameters of the alignment
model.
the lstm gen function of eq. 3 is de   ned by the lstm network with forget gates (gers et al.,
2000) at a single time-step. to generate the next hidden state hgen
, the lstm gen takes the previous
hidden state hgen
t   1 and combines it with the input from both the latent sample zt and the sentence
representation st.
the output of the lstm gen function hgen
is then passed through the write operator which is added
to a cumulative canvas matrix ct     rh  w (eq. 4). the write operator produces two arrays of 1d
)     rw  p whose    lter locations and scales are
gaussian    lter banks fx(hgen
computed from the generative lstm hidden state hgen
(same as de   ned in gregor et al. (2015)).
)     rp  p,
the gaussian    lter banks are then applied to the generated p-by-p image patch k(hgen
placing it onto the canvas:

)     rh  p and fy(hgen

t

t

t

t

t

t

   ct = ct     ct   1 = write(hgen

t

) = fx(hgen

t

)k(hgen

t

)fy(hgen

t

)(cid:62).

(8)

finally, each entry ct,i from the    nal canvas matrix ct is transformed using a sigmoid function    to
produce a conditional bernoulli distribution with mean vector   (ct ) over the h    w image pixels x
given the latent variables z1:t and the input caption y1. in practice, when generating an image x,
instead of sampling from the conditional bernoulli distribution, we simply use the conditional mean
x =   (ct ).

3.3 learning
the model is trained to maximize a variational lower bound l on the marginal likelihood of the
correct image x given the input caption y:

l =

q(z | x, y) log p (x| y, z)     dkl (q(z | x, y)(cid:107) p (z | y))     log p (x| y).

(9)

(cid:88)

z

similar to the draw model, the id136 recurrent network produces an approximate posterior
q(z1:t | x, y) via a read operator, which reads a patch from an input image x using two arrays of
1d gaussian    lters (inverse of write from section 3.2) at each time-step t. speci   cally,

  xt = x       (ct   1),
rt = read (xt,   xt, hgen

q(zt|x, y, z1:t   1) = n(cid:16)

t   1),
= lstm inf er(hinf er
t   1 , [rt, hgen
),   (hinf er
,

  (hinf er

hinf er
t

(cid:17)

)

t

t

t   1]),

(10)
(11)
(12)

(13)

0

where   x is the error image and hinf er
is initialized to the learned bias b. note that the id136
lstm inf er takes as its input both the output of the read operator rt     rp  p, which depends on
the original input image x, and the previous state of the generative decoder hgen
t   1, which depends
on the latent sample history z1:t   1 and dynamic sentence representation st   1 (see eq. 3). hence,
the approximate posterior q will depend on the input image x, the corresponding caption y, and the
latent history z1:t   1, except for the    rst step q(z1|x), which depends only on x.
the terms in the variational lower bound eq. 9 can be rearranged using the law of total expectation.
therefore, the variational bound l is calculated as follows:

l =eq(z1:t | y,x)

dkl (q(zt | z1:t   1, y, x)(cid:107) p (zt | z1:t   1, y))

    dkl (q(z1 | x)(cid:107) p (z1)) .

t=2

(14)

1we also experimented with a conditional gaussian observation model, but it worked worse compared to

the bernoulli model.

4

(cid:34)
log p(x| y, z1:t )     t(cid:88)

(cid:35)

published as a conference paper at iclr 2016

a yellow school bus
parked in a parking lot.

a red school bus parked
in a parking lot.

a green
parked in a parking lot.

school

bus

a blue school bus parked
in a parking lot.

the decadent chocolate
desert is on the table.

a bowl of bananas is on
the table.

a vintage photo of a cat. a vintage photo of a dog.

figure 3: top: examples of changing the color while keeping the caption    xed. bottom: examples of changing
the object while keeping the caption    xed. the shown images are the probabilities   (ct ). best viewed in
colour.
the expectation can be approximated by l monte carlo samples   z1:t from q(z1:t | y, x):

1:t )     t(cid:88)

(cid:0)q(zt |   zl

dkl

1:t   1, y, x)(cid:107) p (zt |   zl

1:t   1, y)(cid:1)(cid:35)

(cid:34)

l(cid:88)

log p(x| y,   zl

l     1
l
    dkl (q(z1 | x)(cid:107) p (z1)) .

l=1

t=2

(15)
the model can be trained using stochastic id119. in all of our experiments, we used
only a single sample from q(z1:t | y, x) for parameter learning. training details, hyperparameter
settings, and the overall model architecture are speci   ed in appendix b. the code is available at
https://github.com/emansim/text2image.

3.4 generating images from captions
during the image generation step, we discard the id136 network and instead sample from the
prior distribution. due to the blurriness of samples generated by the draw model, we perform an
additional post processing step where we use an adversarial network trained on residuals of a lapla-
cian pyramid conditioned on the skipthought representation (kiros et al., 2015) of the captions to
sharpen the generated images, similar to (denton et al., 2015). by    xing the prior of the adversarial
generator to its mean, it gets treated as a deterministic neural network that allows us to de   ne the
conditional data term in eq. 14 on the sharpened images and estimate the variational lower bound
accordingly.

4 experiments

4.1 microsoft coco
microsoft coco (lin et al., 2014) is a large dataset containing 82,783 images, each annotated with
at least 5 captions. the rich collection of images with a wide variety of styles, backgrounds and
objects makes the task of learning a good generative model very challenging. for consistency with
related work on id134, we used only the    rst    ve captions when training and evaluating
our model. the images were resized to 32   32 pixels for consistency with other tiny image datasets
(krizhevsky, 2009). in the following subsections, we analyzed both the qualitative and quantitative
aspects of our model as well as compared its performance with that of other, related generative
models.2 appendix a further reports some additional experiments using the mnist dataset.

4.1.1 analysis of generated images
the main goal of this work is to learn a model that can understand the semantic meaning expressed
in the textual descriptions of images, such as the properties of objects, the relationships between
them, and then use that knowledge to generate relevant images. to examine the understanding of

2to see more generated images, visit http://www.cs.toronto.edu/  emansim/cap2im.html

5

published as a conference paper at iclr 2016

a very large commercial
plane    ying in blue skies.

a very large commer-
cial plane    ying in rainy
skies.

a herd of elephants walk-
ing across a dry grass
   eld.

a herd of elephants walk-
ing across a green grass
   eld.

figure 4: bottom: examples of changing the background while keeping the caption    xed. top: the respective
nearest training images based on pixel-wise l2 distance. the nearest images from the training set also indicate
that the model was not simply copying the patterns it observed during the learning phase.

our model, we wrote a set of captions inspired by the coco dataset and changed some words in the
captions to see whether the model made the relevant changes in the generated samples.
first, we explored whether the model understood one of the most basic properties of any object, the
color. in fig. 3, we generated images of school buses with four different colors: yellow, red, green
and blue. although, there are images of buses with different colors in the training set, all mentioned
school buses are speci   cally colored yellow. despite that, the model managed to generate images of
an object that is visually reminiscent of a school bus that is painted with the speci   ed color.
apart from changing the colors of objects, we next examined whether changing the background of
the scene described in a caption would result in the appropriate changes in the generated samples.
the task of changing the background of an image is somewhat harder than just changing the color of
an object because the model will have to make alterations over a wider visual area. nevertheless, as
shown in fig. 4 changing the skies from blue to rainy in a caption as well as changing the grass type
from dry to green in another caption resulted in the appropriate changes in the generated image.
despite a large number of ways of changing colors and backgrounds in descriptions, in general
we found that the model made appropriate changes as long as some similar pattern was present in
the training set. however, the model struggled when the visual difference between objects was very
small, such as when the objects have the same general shape and color. in fig. 3, we demonstrate that
when we swap two objects that are both visually similar, for example cats and dogs, it is dif   cult
to discriminate solely from the generated samples whether it is an image of a cat or dog, even
though we might notice an animal-like shape. this highlights a limitation of the model in that it has
dif   culty modelling the    ne-grained details of objects.
as a test of model generalization, we tried generating images corresponding to captions that describe
scenarios that are highly unlikely to occur in real life. these captions describe a common object
doing unusual things or set in a strange location, for example    a toilet seat sits open in the grass
   eld   . even though some of these scenarios may never occur in real life, it is very easy for humans
to imagine the corresponding scene. nevertheless, as you can see in fig. 1, the model managed to
generate reasonable images.

4.1.2 analysis of attention
after    ipping sets of words in the captions, we further explored which words the model attended
to when generating images. it turned out that during the generation step, the model mostly focused
on the speci   c words (or nearby words) that carried the main semantic meaning expressed in the
sentences. the attention values of words in sentences helped us interpret the reasons why the model
made the changes it did when we    ipped certain words. for example, in fig. 5, top row, we can see
that when we    ipped the word    desert    to    forest   , the attention over words in the sentence did not
change drastically. this suggests that, in their respective sentences, the model looked at    desert   
and    forest    with relatively equal id203, and thus made the correct changes. in contrast, when
we swap words    beach    and    sun   , we can see a drastic change between sentences in the id203
distribution over words. by noting that the model completely ignores the word    sun    in the second

6

published as a conference paper at iclr 2016

a rider on a blue motor-
cycle in the desert.

a rider on a blue motor-
cycle in the forest.

a surfer, a woman, and a
child walk on the beach.

a surfer, a woman, and a
child walk on the sun.

aligndraw

lapgan

conv-deconv vae

fully-conn vae

figure 5: top: examples of most attended words while changing the background in the caption. bottom: four
different models displaying results from sampling caption a group of people walk on a beach with surf boards.

sentence, we can therefore gain a more thorough understanding of why we see no visual differences
between the images generated by each caption.
we also tried to analyze the way the model generated images. unfortunately, we found that there
was no signi   cant connection between the patches drawn on canvas and the most attended words at
particular time-steps.

4.1.3 comparison with other models
quantitatively evaluating generative models remains a challenging task in itself as each method of
evaluation suffers from its own speci   c drawbacks. compared to reporting classi   cation accuracies
in discriminative models, the measures de   ning generative models are intractable most of the times
and might not correctly de   ne the real quality of the model. to get a better comparison between
performances of different generative models, we report results on two different metrics as well as a
qualitative comparison of different generative models.
we compared the performance of the proposed model to the draw model conditioned on cap-
tions without the align function (noaligndraw) as well as the draw model conditioned on
the skipthought vectors of (kiros et al., 2015) (skipthoughtdraw). all of the conditional draw
models were trained with a binary cross-id178 cost function, i.e. they had bernoulli conditional
likelihoods. we also compared our model with fully-connected (fully-conn) and convolutional-
deconvolutional (conv-deconv) id5 which were trained with the least squares
cost function. the lapgan model of (denton et al., 2015) was trained on a two level lapla-
cian pyramid with a gan as a top layer generator and all stages were conditioned on the same
skipthought vector.
in fig. 5, bottom row, we generated several samples from the prior of each of the current state-of-
the-art generative models, conditioned on the caption    a group of people walk on a beach with surf
boards   . while all of the samples look sharp, the images generated by lapgan look more noisy
and it is harder to make out de   nite objects, whereas the images generated by variational models
trained with least squares cost function have a watercolor effect on the images. we found that the
quality of generated samples was similar among different variants of conditional draw models.
as for the quantitative comparison of different models, we    rst compare the performances of the
model trained with variational methods. we rank the images in the test set conditioned on the
captions based on the variational lower bound of the log-probabilities and then report the precision-
recall metric as an evaluation of the quality of the generative model (see table 1.). perhaps un-
surprisingly, generative models did not perform well on the id162 task. to deal with the
large computational complexity involved in looping through each test image, we create a shortlist
of one hundred images including the correct one, based on the images having the closest euclidean
distance in the last fully-connected feature space of a vgg-like model (simonyan & zisserman,
2015) trained on the cifar dataset3 (krizhevsky, 2009). since there are    easy    images for which

3the architecture of the model is described here http://torch.ch/blog/2015/07/30/cifar.
html. the shortlist of test images used for evaluation can be downloaded from http://www.cs.
toronto.edu/  emansim/cap2im/test-nns.pkl.

7

published as a conference paper at iclr 2016

model

lapgan

fully-conn vae
conv-deconv vae
skipthoughtdraw

noaligndraw
aligndraw

microsoft coco (prior to sharpening)

id162

r@1 r@5 r@10 r@50 med r

-
1.0
1.0
2.0
2.8
3.0

-
6.6
6.5
11.2
14.1
14.0

-

12.0
12.0
18.9
23.1
22.9

-

53.4
52.9
63.3
68.0
68.5

-
47
48
36
31
31

image similarity

ssi

0.08    0.07
0.156    0.10
0.164    0.10
0.157    0.11
0.155    0.11
0.156    0.11

table 1: retrieval results of different models. r@k is recall@k (higher is better). med r is the median rank
(lower is better). ssi is structural similarity index, which is between    1 and 1 (higher is better).

the model assigns high log-probabilities independent of the query caption, we instead look at the
ratio of the likelihood of the image conditioned on the sentence to the likelihood of the image con-
ditioned on the mean sentence representation in the training set, following the retrieval protocol
of (kiros et al., 2014b). we also found that the lower bound on the test log-probabilities decreased
for sharpened images, and that sharpening considerably hurt the retrieval results. since sharpening
changes the statistics of images, the estimated log-probabilities of image pixels is not necessarily
a good metric. some examples of generated images before and after sharpening are shown in ap-
pendix c.
instead of calculating error per pixel, we turn to a smarter metric, the structural similarity index
(ssi) (wang et al., 2004), which incorporates luminance and contrast masking into the error cal-
culation. strong inter-dependencies of closer pixels are also taken into account and the metric is
calculated on small windows of the images. due to independence property of test captions, we sam-
pled    fty images from the prior of each generative model for every caption in the test set in order
to calculate ssi. as you can see on table 1, ssi scores achieved by variational models were higher
compared to ssi score achieved by lapgan.

5 discussion
in this paper, we demonstrated that the aligndraw model, a combination of a recurrent variational
autoencoder with an alignment model over words, succeeded in generating images that correspond
to a given input caption. by extensively using attentional mechanisms, our model gained several
advantages. namely, the use of the visual attention mechanism allowed us to decompose the problem
of image generation into a series of steps instead of a single forward pass, while the attention over
words provided us an insight whenever our model failed to generate a relevant image. additionally,
our model generated images corresponding to captions which generalized beyond the training set,
such as sentences describing novel scenarios which are highly unlikely to occur in real life.
because the aligndraw model tends to output slightly blurry samples, we augmented the model
with a sharpening post-processing step in which gan generated edges which were added to the
aligndraw samples. unfortunately, this is not an ideal solution due to the fact that the whole
model was not trained in an end-to-end fashion. therefore a direction of future work would be to
   nd methods that can bypass the separate post-processing step and output sharp images directly in
an end-to-end manner.
acknowledgments: this work was supported by samsung and iarpa, raytheon bbn contract no.
d11pc20071. we would like to thank developers of theano (bastien et al., 2012), the authors of (denton
et al., 2015) for open sourcing their code, and ryan kiros and nitish srivastava for helpful discussions.

references
bachman, philip and precup, doina. data generation as sequential decision making. in nips, 2015.

bahdanau, d., cho, k., and bengio, y. id4 by jointly learning to align and translate. in

iclr, 2015.

bastien, fr  ed  eric, lamblin, pascal, pascanu, razvan, bergstra, james, goodfellow, ian j., bergeron, arnaud,
bouchard, nicolas, warde-farley, david, and bengio, yoshua. theano: new features and speed improve-
ments. corr, abs/1211.5590, 2012.

8

published as a conference paper at iclr 2016

cho, k., van merrienboer, b., g  ulc  ehre, c   ., bahdanau, d., bougares, f., schwenk, h., and bengio, y. learning

phrase representations using id56 encoder-decoder for id151. in emnlp, 2014.

denton, emily l., chintala, soumith, szlam, arthur, and fergus, robert. deep generative image models using

a laplacian pyramid of adversarial networks. in nips, 2015.

gers, felix, schmidhuber, j  urgen, and cummins, fred. learning to forget: continual prediction with lstm.

neural computation, 2000.

goodfellow, ian j., pouget-abadie, jean, mirza, mehdi, xu, bing, warde-farley, david, ozair, sherjil,

courville, aaron c., and bengio, yoshua. generative adversarial nets. in nips, 2014.

graves, a., jaitly, n., and mohamed, a.-r. hybrid id103 with deep bidirectional lstm. in ieee

workshop on automatic id103 and understanding, 2013.

gregor, karol, danihelka, ivo, graves, alex, and wierstra, daan. draw: a recurrent neural network for

image generation. in icml, 2015.

gutmann, michael and hyv  arinen, aapo. noise-contrastive estimation: a new estimation principle for unnor-

malized statistical models. in aistats, 2010.

hinton, geoffrey e., osindero, simon, and teh, yee whye. a fast learning algorithm for deep belief nets.

neural computation, 2006.

hochreiter, sepp and schmidhuber, j  urgen. long short-term memory. neural computation, 1997.

karpathy, andrej and li, fei-fei. deep visual-semantic alignments for generating image descriptions.

cvpr, 2015.

in

kingma, diederik p. and welling, max. auto-encoding id58. in iclr, 2014.
kiros, r., salakhutdinov, r., and zemel, r. multimodal neural language models. in icml, 2014a.

kiros, ryan, salakhutdinov, ruslan, and zemel, richard s. unifying visual-semantic embeddings with multi-

modal neural language models. corr, abs/1411.2539, 2014b.

kiros, ryan, zhu, yukun, salakhutdinov, ruslan, zemel, richard s., torralba, antonio, urtasun, raquel, and

fidler, sanja. skip-thought vectors. in nips, 2015.

krizhevsky, alex. learning multiple layers of features from tiny images. master   s thesis, department of

computer science, university of toronto, 2009.

krizhevsky, alex, sutskever, ilya, and hinton, geoffrey e. id163 classi   cation with deep convolutional

neural networks. in nips, 2012.

lin, t.y., maire, m., belongie, s., hays, j., perona, p., ramanan, d., doll  ar, p., and zitnick, c. l. microsoft

coco: common objects in context. in eccv, 2014.

rezende, danilo j., mohamed, shakir, and wierstra, daan. stochastic id26 and variational infer-

ence in deep latent gaussian models. in icml, 2014.

salakhutdinov, ruslan and hinton, geoffrey e. deep id82s. in aistats, 2009.

simonyan, karen and zisserman, andrew. very deep convolutional networks for large-scale image recognition.

in iclr, 2015.

smolensky, paul.

information processing in dynamical systems: foundations of harmony theory. parallel

distributed processing: explorations in the microstructure of cognition, 1986.

srivastava, nitish, mansimov, elman, and salakhutdinov, ruslan. unsupervised learning of video representa-

tions using lstms. in icml, 2015.

sutskever, ilya, vinyals, oriol, and le, quoc v. sequence to sequence learning with neural networks. in nips,

2014.

vinyals, oriol, toshev, alexander, bengio, samy, and erhan, dumitru. show and tell: a neural image caption

generator. in cvpr, 2015.

wang, zhou, bovik, alan c., sheikh, hamid r., and simoncelli, eero p. image quality assessment: from error

visibility to structural similarity. ieee transactions on image processing, 2004.

xu, kelvin, ba, jimmy, kiros, ryan, cho, kyunghyun, courville, aaron c., salakhutdinov, ruslan, zemel,
richard s., and bengio, yoshua. show, attend and tell: neural image id134 with visual atten-
tion. in icml, 2015.

9

published as a conference paper at iclr 2016

figure 6: examples of generating 60    60 mnist images corresponding to respective captions. the captions
on the left column were part of the training set. the digits described in the captions on the right column were
hidden during training for the respective con   gurations.

appendix a: mnist with captions

as an additional experiment, we trained our model on the mnist dataset with arti   cial captions.
either one or two digits from the mnist training dataset were placed on a 60    60 blank image.
one digit was placed in one of the four (top-left, top-right, bottom-left or bottom-right) corners
of the image. two digits were either placed horizontally or vertically in non-overlapping fashion.
the corresponding arti   cial captions speci   ed the identity of each digit along with their relative
positions, e.g.    the digit three is at the top of the digit one   , or    the digit seven is at the bottom left
of the image   .
the generated images together with the attention alignments are displayed in figure 6. the model
correctly displayed the speci   ed digits at the described positions and even managed to generalize
reasonably well to the con   gurations that were never present during training. in the case of gener-
ating two digits, the model would dynamically attend to the digit in the caption it was drawing at
that particular time-step. similarly, in the setting where the caption speci   ed only a single digit, the
model would correctly attend to the digit in the caption during the whole generation process. in both
cases, the model placed small attention values on the words describing the position of digits in the
images.

appendix b: training details

hyperparameters

each parameter in aligndraw was initialized by sampling from a gaussian distribution with mean
0 and standard deviation 0.01. the model was trained using rmsprop with an initial learning rate
of 0.001. for the microsoft coco task, we trained our model for 18 epochs. the learning rate
was reduced to 0.0001 after 11 epochs. for the mnist with captions task, the model was trained
for 150 epochs and the learning rate was reduced to 0.0001 after 110 epochs. during each epoch,
randomly created 10, 000 training samples were used for learning. the norm of the gradients was
clipped at 10 during training to avoid the exploding gradients problem.
we used a vocabulary size of k = 25323 and k = 22 for the microsoft coco and mnist with
captions datasets respectively. all capital letters in the words were converted to small letters as a
in the language model had
preprocessing step. for all tasks, the hidden states
128 units. hence the dimensionality of the concatenated state of the bidirectional lstm hlang
=
      
h lang
] was 256. the parameters in the align operator (eq. 7) had a dimensionality of
[
l = 512, so that v     r512, u     r512  256, w     r512  ngen and b     r512. the architectural
con   gurations of the aligndraw models are shown in table 2.

      
h lang

      
h lang

      
h lang

and

,

i

i

i

i

i

10

published as a conference paper at iclr 2016

task

ms coco

mnist

aligndraw model

#glimpses

id136

generative

latent
dim of hinf er dim of hgen dim of z

t
32
32
table 2: the architectural con   gurations of aligndraw models.

550
300

550
300

275
150

read size write size

p
9
8

p
9
8

the gan model used for sharpening had the same con   guration as the 28    28 model trained
by denton et al. (2015) on the edge residuals of the cifar dataset. the con   guration can be
found at https://gist.github.com/soumith/e3f722173ea16c1ea0d9. the model
was trained for 6 epochs.

evaluation

table 3 shows the estimated variational lower bounds on the average train/validation/test log-
probabilities. note that the aligndraw model does not suffer much from over   tting. the results
substantially worsen after sharpening test images.

model

train

skipthoughtdraw -1794.29
-1792.14
-1792.15

noaligndraw
aligndraw

validation
-1797.41
-1796.94
-1797.24

test

-1791.37
-1791.15
-1791.53

test (after sharpening)

-2045.84
-2051.07
-2042.31

table 3: the lower bound on the average test log-probabilities of conditional draw models, trained on the
microsoft coco dataset.

11

published as a conference paper at iclr 2016

appendix c: effect of sharpening images.
some examples of generated images before (top row) and after (bottom row) sharpening im-
ages using an adversarial network trained on residuals of a laplacian pyramid conditioned on the
skipthought vectors of the captions.

figure 7: effect of sharpening images.

12

