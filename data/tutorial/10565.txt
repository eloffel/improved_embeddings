show, attend and tell: neural image caption

generation with visual attention

6
1
0
2

 
r
p
a
9
1

 

 
 
]

g
l
.
s
c
[
 
 

3
v
4
4
0
3
0

.

2
0
5
1
:
v
i
x
r
a

kelvin xu
jimmy lei ba
ryan kiros
kyunghyun cho
aaron courville
ruslan salakhutdinov
richard s. zemel
yoshua bengio

abstract

inspired by recent work in machine translation
and id164, we introduce an attention
based model that automatically learns to describe
the content of images. we describe how we
can train this model in a deterministic manner
using standard id26 techniques and
stochastically by maximizing a variational lower
bound. we also show through visualization how
the model is able to automatically learn to    x its
gaze on salient objects while generating the cor-
responding words in the output sequence. we
validate the use of attention with state-of-the-
art performance on three benchmark datasets:
flickr8k, flickr30k and ms coco.

1. introduction
automatically generating captions of an image is a task
very close to the heart of scene understanding     one of the
primary goals of id161. not only must caption
generation models be powerful enough to solve the com-
puter vision challenges of determining which objects are in
an image, but they must also be capable of capturing and
expressing their relationships in a natural language. for
this reason, id134 has long been viewed as
a dif   cult problem.
it is a very important challenge for
machine learning algorithms, as it amounts to mimicking
the remarkable human ability to compress huge amounts of
salient visual infomation into descriptive language.
despite the challenging nature of this task, there has been
a recent surge of research interest in attacking the image
id134 problem. aided by advances in training
neural networks (krizhevsky et al., 2012) and large clas-
si   cation datasets (russakovsky et al., 2014), recent work

kelvin.xu@umontreal.ca
jimmy@psi.utoronto.ca
rkiros@cs.toronto.edu
kyunghyun.cho@umontreal.ca
aaron.courville@umontreal.ca
rsalakhu@cs.toronto.edu
zemel@cs.toronto.edu
find-me@the.web

figure 1. our model learns a words/image alignment. the visual-
ized attentional maps (3) are explained in section 3.1 & 5.4

has signi   cantly improved the quality of caption genera-
tion using a combination of convolutional neural networks
(convnets) to obtain vectorial representation of images and
recurrent neural networks to decode those representations
into natural language sentences (see sec. 2).
one of the most curious facets of the human visual sys-
tem is the presence of attention (rensink, 2000; corbetta &
shulman, 2002). rather than compress an entire image into
a static representation, attention allows for salient features
to dynamically come to the forefront as needed. this is
especially important when there is a lot of clutter in an im-
age. using representations (such as those from the top layer
of a convnet) that distill information in image down to the
most salient objects is one effective solution that has been
widely adopted in previous work. unfortunately, this has
one potential drawback of losing information which could
be useful for richer, more descriptive captions. using more
low-level representation can help preserve this information.
however working with these features necessitates a power-
ful mechanism to steer the model to information important
to the task at hand.
in this paper, we describe approaches to caption genera-
tion that attempt to incorporate a form of attention with

1. input     image2. convolutionalfeature extraction3. id56 with attentionlstm4. word by word14x14 feature mapover the imagegenerationabird    ying over a body of water neural image id134 with visual attention

figure 2. attention over time. as the model generates each word, its attention changes to re   ect the relevant parts of the image.    soft   
(top row) vs    hard    (bottom row) attention. (note that both models generated the same captions in this example.)

figure 3. examples of attending to the correct object (white indicates the attended regions, underlines indicated the corresponding word)

two variants: a    hard    attention mechanism and a    soft   
attention mechanism. we also show how one advantage of
including attention is the ability to visualize what the model
   sees   . encouraged by recent advances in caption genera-
tion and inspired by recent success in employing attention
in machine translation (bahdanau et al., 2014) and object
recognition (ba et al., 2014; mnih et al., 2014), we investi-
gate models that can attend to salient part of an image while
generating its caption.
the contributions of this paper are the following:

    we introduce two attention-based image caption gen-
erators under a common framework (sec. 3.1): 1) a
   soft    deterministic attention mechanism trainable by
standard back-propagation methods and 2) a    hard   
stochastic attention mechanism trainable by maximiz-
ing an approximate variational lower bound or equiv-
alently by reinforce (williams, 1992).
    we show how we can gain insight and interpret the
results of this framework by visualizing    where    and
   what    the attention focused on. (see sec. 5.4)
    finally, we quantitatively validate the usefulness of
attention in id134 with state of the art
performance (sec. 5.3) on three benchmark datasets:
flickr8k (hodosh et al., 2013) , flickr30k (young
et al., 2014) and the ms coco dataset (lin et al.,
2014).

2. related work
in this section we provide relevant background on previous
work on image id134 and attention. recently,
several methods have been proposed for generating image
descriptions. many of these methods are based on recur-
rent neural networks and inspired by the successful use of
sequence to sequence training with neural networks for ma-
chine translation (cho et al., 2014; bahdanau et al., 2014;
sutskever et al., 2014). one major reason image caption
generation is well suited to the encoder-decoder framework
(cho et al., 2014) of machine translation is because it is
analogous to    translating    an image to a sentence.
the    rst approach to use neural networks for caption gener-
ation was kiros et al. (2014a), who proposed a multimodal
log-bilinear model that was biased by features from the im-
age. this work was later followed by kiros et al. (2014b)
whose method was designed to explicitly allow a natural
way of doing both ranking and generation. mao et al.
(2014) took a similar approach to generation but replaced a
feed-forward neural language model with a recurrent one.
both vinyals et al. (2014) and donahue et al. (2014) use
lstm id56s for their models. unlike kiros et al. (2014a)
and mao et al. (2014) whose models see the image at each
time step of the output word sequence, vinyals et al. (2014)
only show the image to the id56 at the beginning. along

neural image id134 with visual attention

with images, donahue et al. (2014) also apply lstms to
videos, allowing their model to generate video descriptions.
all of these works represent images as a single feature vec-
tor from the top layer of a pre-trained convolutional net-
work. karpathy & li (2014) instead proposed to learn a
joint embedding space for ranking and generation whose
model learns to score sentence and image similarity as a
function of r-id98 id164s with outputs of a bidi-
rectional id56. fang et al. (2014) proposed a three-step
pipeline for generation by incorporating id164s.
their model    rst learn detectors for several visual concepts
based on a multi-instance learning framework. a language
model trained on captions was then applied to the detector
outputs, followed by rescoring from a joint image-text em-
bedding space. unlike these models, our proposed atten-
tion framework does not explicitly use object detectors but
instead learns latent alignments from scratch. this allows
our model to go beyond    objectness    and learn to attend to
abstract concepts.
prior to the use of neural networks for generating captions,
two main approaches were dominant. the    rst involved
generating caption templates which were    lled in based
on the results of id164s and attribute discovery
(kulkarni et al. (2013), li et al. (2011), yang et al. (2011),
mitchell et al. (2012), elliott & keller (2013)). the second
approach was based on    rst retrieving similar captioned im-
ages from a large database then modifying these retrieved
captions to    t the query (kuznetsova et al., 2012; 2014).
these approaches typically involved an intermediate    gen-
eralization    step to remove the speci   cs of a caption that
are only relevant to the retrieved image, such as the name
of a city. both of these approaches have since fallen out of
favour to the now dominant neural network methods.
there has been a long line of previous work incorpo-
rating attention into neural networks for vision related
tasks. some that share the same spirit as our work include
larochelle & hinton (2010); denil et al. (2012); tang et al.
(2014). in particular however, our work directly extends
the work of bahdanau et al. (2014); mnih et al. (2014); ba
et al. (2014).

3. image id134 with attention

mechanism
3.1. model details

in this section, we describe the two variants of our
attention-based model by    rst describing their common
framework. the main difference is the de   nition of the
   function which we describe in detail in section 4. we
denote vectors with bolded font and matrices with capital
letters. in our description below, we suppress bias terms for
readability.

figure 4. a lstm cell, lines with bolded squares imply projec-
tions with a learnt weight vector. each cell learns how to weigh
its input components (input gate), while learning how to modulate
that contribution to the memory (input modulator). it also learns
weights which erase the memory cell (forget gate), and weights
which control how this memory should be emitted (output gate).

3.1.1. encoder: convolutional features

our model takes a single raw image and generates a caption
y encoded as a sequence of 1-of-k encoded words.

y = {y1, . . . , yc} , yi     rk

where k is the size of the vocabulary and c is the length
of the caption.
we use a convolutional neural network in order to extract a
set of feature vectors which we refer to as annotation vec-
tors. the extractor produces l vectors, each of which is
a d-dimensional representation corresponding to a part of
the image.

a = {a1, . . . , al} , ai     rd

in order to obtain a correspondence between the feature
vectors and portions of the 2-d image, we extract features
from a lower convolutional layer unlike previous work
which instead used a fully connected layer. this allows the
decoder to selectively focus on certain parts of an image by
selecting a subset of all the feature vectors.

3.1.2. decoder: long short-term memory

network

a

we use
long short-term memory (lstm) net-
work (hochreiter & schmidhuber, 1997) that produces a
caption by generating one word at every time step condi-
tioned on a context vector, the previous hidden state and the
previously generated words. our implementation of lstm

fcoihtht-1zteyt-1ht-1zteyt-1ht-1zteyt-1ht-1zteyt-1input gateoutput gatememory cellforget gateinput modulatorneural image id134 with visual attention

closely follows the one used in zaremba et al. (2014) (see
fig. 4). using ts,t : rs     rt to denote a simple af   ne
transformation with parameters that are learned,

             it

ft
ot
gt

             =

               

  
  

             td+m+n,n

tanh

ct = ft (cid:12) ct   1 + it (cid:12) gt
ht = ot (cid:12) tanh(ct).

      eyt   1

ht   1
  zt

      

(1)

(2)
(3)

here, it, ft, ct, ot, ht are the input, forget, memory, out-
put and hidden state of the lstm, respectively. the vector
  z     rd is the context vector, capturing the visual infor-
mation associated with a particular input location, as ex-
plained below. e     rm  k is an embedding matrix. let
m and n denote the embedding and lstm dimensionality
respectively and    and (cid:12) be the logistic sigmoid activation
and element-wise multiplication respectively.
in simple terms, the context vector   zt (equations (1)   (3)) is
a dynamic representation of the relevant part of the image
input at time t. we de   ne a mechanism    that computes   zt
from the annotation vectors ai, i = 1, . . . , l corresponding
to the features extracted at different image locations. for
each location i, the mechanism generates a positive weight
  i which can be interpreted either as the id203 that
location i is the right place to focus for producing the next
word (the    hard    but stochastic attention mechanism), or as
the relative importance to give to location i in blending the
ai   s together. the weight   i of each annotation vector ai
is computed by an attention model fatt for which we use
a multilayer id88 conditioned on the previous hidden
state ht   1. the soft version of this attention mechanism
was introduced by bahdanau et al. (2014). for emphasis,
we note that the hidden state varies as the output id56 ad-
vances in its output sequence:    where    the network looks
next depends on the sequence of words that has already
been generated.

eti =fatt(ai, ht   1)

(cid:80)l

exp(eti)
k=1 exp(etk)

  ti =

(4)

(5)

.

through two separate mlps (init,c and init,h):

l(cid:88)
l(cid:88)

i

i

ai)

ai)

c0 = finit,c(

h0 = finit,h(

1
l

1
l

in this work, we use a deep output layer (pascanu et al.,
2014) to compute the output word id203 given the
lstm state, the context vector and the previous word:
)     exp(lo(eyt   1 + lhht + lz  zt))

(7)
where lo     rk  m, lh     rm  n, lz     rm  d, and e
are learned parameters initialized randomly.

p(yt|a, yt   1

1

4. learning stochastic    hard    vs
deterministic    soft    attention

in this section we discuss two alternative mechanisms for
the attention model fatt: stochastic attention and determin-
istic attention.

4.1. stochastic    hard    attention

we represent the location variable st as where the model
decides to focus attention when generating the tth word.
st,i is an indicator one-hot variable which is set to 1 if the
i-th location (out of l) is the one used to extract visual
features. by treating the attention locations as intermedi-
ate latent variables, we can assign a multinoulli distribution
parametrized by {  i}, and view   zt as a random variable:
(8)

p(st,i = 1 | sj<t, a) =   t,i
  zt =

st,iai.

(9)

(cid:88)

i

we de   ne a new objective function ls that is a variational
lower bound on the marginal log-likelihood log p(y | a) of
observing the sequence of words y given image features a.
the learning algorithm for the parameters w of the models
can be derived by directly optimizing ls:

(cid:88)

ls =

p(s | a) log p(y | s, a)

p(s | a)p(y | s, a)

s

    log
= log p(y | a)

(cid:88)
(cid:20)     log p(y | s, a)

s

p(s | a)

+

   w
log p(y | s, a)

    log p(s | a)

   w

(10)

(11)

(cid:21)

.

once the weights (which sum to one) are computed, the
context vector   zt is computed by

  zt =    ({ai} ,{  i}) ,

(6)

where    is a function that returns a single vector given the
set of annotation vectors and their corresponding weights.
the details of    function are discussed in sec. 4.
the initial memory state and hidden state of the lstm
are predicted by an average of the annotation vectors fed

(cid:88)

s

   ls
   w

=

neural image id134 with visual attention

figure 5. examples of mistakes where we can use attention to gain intuition into what the model saw.

equation 11 suggests a monte carlo based sampling ap-
proximation of the gradient with respect to the model pa-
rameters. this can be done by sampling the location st
from a multinouilli distribution de   ned by equation 8.

  st     multinoullil({  i})

n(cid:88)

n=1

   ls
   w

    1
n

(cid:20)     log p(y |   sn, a)

   w

log p(y |   sn, a)

+
    log p(  sn | a)

   w

(cid:21)

(12)

a moving average baseline is used to reduce the vari-
ance in the monte carlo estimator of the gradient, follow-
ing weaver & tao (2001). similar, but more complicated
variance reduction techniques have previously been used
by mnih et al. (2014) and ba et al. (2014). upon seeing the
kth mini-batch, the moving average baseline is estimated
as an accumulated sum of the previous log likelihoods with
exponential decay:

bk = 0.9    bk   1 + 0.1    log p(y |   sk, a)

to further reduce the estimator variance, an id178 term
on the multinouilli distribution h[s] is added. also, with
id203 0.5 for a given image, we set the sampled at-
tention location   s to its expected value   . both techniques
improve the robustness of the stochastic attention learning
algorithm. the    nal learning rule for the model is then the

following:

(cid:20)     log p(y |   sn, a)

n(cid:88)

    1
n

   ls
   w
  r(log p(y |   sn, a)     b)

n=1

+
   w
    log p(  sn | a)

   w

(cid:21)

+   e

   h[  sn]

   w

where,   r and   e are two hyper-parameters set by cross-
validation. as pointed out and used in ba et al. (2014)
and mnih et al. (2014), this is formulation is equivalent to
the reinforce learning rule (williams, 1992), where the
reward for the attention choosing a sequence of actions is
a real value proportional to the log likelihood of the target
sentence under the sampled attention trajectory.
in making a hard choice at every point,    ({ai} ,{  i})
from equation 6 is a function that returns a sampled ai at
every point in time based upon a multinouilli distribution
parameterized by   .

4.2. deterministic    soft    attention

learning stochastic attention requires sampling the atten-
tion location st each time, instead we can take the expecta-
tion of the context vector   zt directly,

ep(st|a)[  zt] =

  t,iai

(13)

i=1

   ({ai} ,{  i}) = (cid:80)l

and formulate a deterministic attention model by com-
puting a soft attention weighted annotation vector
i   iai as introduced by bahdanau
et al. (2014). this corresponds to feeding in a soft   

l(cid:88)

neural image id134 with visual attention

weighted context into the system. the whole model is
smooth and differentiable under the deterministic attention,
so learning end-to-end is trivial by using standard back-
propagation.
learning the deterministic attention can also be under-
stood as approximately optimizing the marginal likelihood
in equation 10 under the attention location random vari-
able st from sec. 4.1. the hidden activation of lstm
ht is a linear projection of the stochastic context vector
  zt followed by tanh non-linearity. to the    rst order tay-
lor approximation, the expected value ep(st|a)[ht] is equal
to computing ht using a single forward prop with the ex-
pected context vector ep(st|a)[  zt]. considering eq. 7, let
nt = lo(eyt   1+lhht+lz  zt), nt,i denotes nt computed
by setting the random variable   z value to ai. we de   ne the
normalized weighted geometric mean for the softmax kth
word prediction:

n w gm [p(yt = k | a)] =

=

(cid:81)
(cid:80)
(cid:81)
i exp(nt,k,i)p(st,i=1|a)
i exp(nt,j,i)p(st,i=1|a)
(cid:80)

exp(ep(st|a)[nt,k])
j exp(ep(st|a)[nt,j])

j

the equation above shows the normalized weighted ge-
ometric mean of the caption prediction can be approxi-
mated well by using the expected context vector, where
e[nt] = lo(eyt   1 + lhe[ht] + lze[  zt]). it shows that
the nwgm of a softmax unit is obtained by applying soft-
max to the expectations of the underlying linear projec-
tions. also, from the results in (baldi & sadowski, 2014),
n w gm [p(yt = k | a)]     e[p(yt = k | a)] under
softmax activation. that means the expectation of the out-
puts over all possible attention locations induced by ran-
dom variable st is computed by simple feedforward propa-
gation with expected context vector e[  zt]. in other words,
the deterministic attention model is an approximation to the
marginal likelihood over the attention locations.

4.2.1. doubly stochastic attention

by construction, (cid:80)
where we also encourage (cid:80)

i   ti = 1 as they are the output of a
softmax. in training the deterministic version of our model
we introduce a form of doubly stochastic id173,
t   ti     1. this can be in-
terpreted as encouraging the model to pay equal attention
to every part of the image over the course of generation. in
our experiments, we observed that this penalty was impor-
tant quantitatively to improving overall id7 score and
that qualitatively this leads to more rich and descriptive
captions. in addition, the soft attention model predicts a
gating scalar    from previous hidden state ht   1 at each
i   iai, where
  t =   (f  (ht   1)). we notice our attention weights put
more emphasis on the objects in the images by including

time step t, such that,    ({ai} ,{  i}) =   (cid:80)l

the scalar   .
concretely, the model is trained end-to-end by minimizing
the following penalized negative log-likelihood:

l(cid:88)

(1     c(cid:88)

i

t

  ti)2

(14)

ld =     log(p (y|x)) +   

4.3. training procedure

both variants of our attention model were trained with
stochastic id119 using adaptive learning rate al-
gorithms. for the flickr8k dataset, we found that rm-
sprop (tieleman & hinton, 2012) worked best, while for
flickr30k/ms coco dataset we used the recently pro-
posed adam algorithm (kingma & ba, 2014) .
to create the annotations ai used by our decoder, we used
the oxford vggnet (simonyan & zisserman, 2014) pre-
trained on id163 without    netuning. in principle how-
ever, any encoding function could be used.
in addition,
with enough data, we could also train the encoder from
scratch (or    ne-tune) with the rest of the model. in our ex-
periments we use the 14  14  512 feature map of the fourth
convolutional layer before max pooling. this means our
decoder operates on the    attened 196    512 (i.e l    d)
encoding.
as our implementation requires time proportional to the
length of the longest sentence per update, we found train-
ing on a random group of captions to be computationally
wasteful. to mitigate this problem, in preprocessing we
build a dictionary mapping the length of a sentence to the
corresponding subset of captions. then, during training we
randomly sample a length and retrieve a mini-batch of size
64 of that length. we found that this greatly improved con-
vergence speed with no noticeable diminishment in perfor-
mance. on our largest dataset (ms coco), our soft atten-
tion model took less than 3 days to train on an nvidia
titan black gpu.
in addition to dropout (srivastava et al., 2014), the only
other id173 strategy we used was early stopping
on id7 score. we observed a breakdown in correla-
tion between the validation set log-likelihood and id7 in
the later stages of training during our experiments. since
id7 is the most commonly reported metric, we used
id7 on our validation set for model selection.
in our experiments with soft attention, we also used whet-
lab1 (snoek et al., 2012; 2014) in our flickr8k experi-
ments. some of the intuitions we gained from hyperparam-
eter regions it explored were especially important in our
flickr30k and coco experiments.
we make our code for these models based in theano

1https://www.whetlab.com/

neural image id134 with visual attention

table 1. id7-1,2,3,4/meteor metrics compared to other methods,     indicates a different split, (   ) indicates an unknown metric,    
indicates the authors kindly provided missing metrics by personal communication,    indicates an ensemble, a indicates using alexnet

id7

id7-1 id7-2 id7-3 id7-4 meteor

model

google nic(vinyals et al., 2014)     
log bilinear (kiros et al., 2014a)   

soft-attention
hard-attention
google nic        
log bilinear
soft-attention
hard-attention

google nic        
log bilinear   
soft-attention
hard-attention

cmu/ms research (chen & zitnick, 2014)a

ms research (fang et al., 2014)   a
bid56 (karpathy & li, 2014)   

63
65.6
67
67
66.3
60.0
66.7
66.9
   
   
64.2
66.6
70.8
70.7
71.8

41
42.4
44.8
45.7
42.3
38
43.4
43.9
   
   
45.1
46.1
48.9
49.2
50.4

27
27.7
29.9
31.4
27.7
25.4
28.8
29.6
   
   
30.4
32.9
34.4
34.4
35.7

   
17.7
19.5
21.3
18.3
17.1
19.1
19.9
   
   
20.3
24.6
24.3
24.3
25.0

   

17.31
18.93
20.30
   

16.88
18.49
18.46
20.41
20.71

   
   

20.03
23.90
23.04

dataset

flickr8k

flickr30k

coco

(bergstra et al., 2010) publicly available upon publication
to encourage future research in this area.

5. experiments
we describe our experimental methodology and quantita-
tive results which validate the effectiveness of our model
for id134.

5.1. data

we report results on the popular flickr8k and flickr30k
dataset which has 8,000 and 30,000 images respectively
as well as the more challenging microsoft coco dataset
which has 82,783 images. the flickr8k/flickr30k dataset
both come with 5 reference sentences per image, but for
the ms coco dataset, some of the images have references
in excess of 5 which for consistency across our datasets
we discard. we applied only basic id121 to ms
coco so that it is consistent with the id121 present
in flickr8k and flickr30k. for all our experiments, we used
a    xed vocabulary size of 10,000.
results for our attention-based architecture are reported in
table 4.2.1. we report results with the frequently used
id7 metric2 which is the standard in the caption gen-
eration literature. we report id7 from 1 to 4 with-

2we veri   ed that our id7 evaluation code matches the au-
thors of vinyals et al. (2014), karpathy & li (2014) and kiros
et al. (2014b). for fairness, we only compare against results for
which we have veri   ed that our id7 evaluation code is the
same. with the upcoming release of the coco evaluation server,
we will include comparison results with all other recent image
captioning models.

out a brevity penalty. there has been, however, criticism
of id7, so in addition we report another common met-
ric meteor (denkowski & lavie, 2014), and compare
whenever possible.

5.2. evaluation procedures

a few challenges exist for comparison, which we explain
here. the    rst is a difference in choice of convolutional
feature extractor. for identical decoder architectures, us-
ing more recent architectures such as googlenet or ox-
ford vgg szegedy et al. (2014), simonyan & zisserman
(2014) can give a boost in performance over using the
alexnet (krizhevsky et al., 2012). in our evaluation, we
compare directly only with results which use the compa-
rable googlenet/oxford vgg features, but for meteor
comparison we note some results that use alexnet.
the second challenge is a single model versus ensemble
comparison. while other methods have reported perfor-
mance boosts by using ensembling, in our results we report
a single model performance.
there is challenge due to differences between
finally,
dataset splits.
in our reported results, we use the pre-
de   ned splits of flickr8k. however, one challenge for the
flickr30k and coco datasets is the lack of standardized
splits. as a result, we report with the publicly available
splits3 used in previous work (karpathy & li, 2014). in our
experience, differences in splits do not make a substantial
difference in overall performance, but we note the differ-

3http://cs.stanford.edu/people/karpathy/

deepimagesent/

neural image id134 with visual attention

ences where they exist.

5.3. quantitative analysis

in table 4.2.1, we provide a summary of the experi-
ment validating the quantitative effectiveness of attention.
we obtain state of the art performance on the flickr8k,
flickr30k and ms coco. in addition, we note that in our
experiments we are able to signi   cantly improve the state
of the art performance meteor on ms coco that we
speculate is connected to some of the id173 tech-
niques we used 4.2.1 and our lower level representation.
finally, we also note that we are able to obtain this perfor-
mance using a single model without an ensemble.

5.4. qualitative analysis: learning to attend

by visualizing the attention component learned by the
model, we are able to add an extra layer of interpretabil-
ity to the output of the model (see fig. 1). other systems
that have done this rely on id164 systems to pro-
duce candidate alignment targets (karpathy & li, 2014).
our approach is much more    exible, since the model can
attend to    non object    salient regions.
the 19-layer oxfordnet uses stacks of 3x3    lters mean-
ing the only time the feature maps decrease in size are due
to the max pooling layers. the input image is resized so
that the shortest side is 256 dimensional with preserved as-
pect ratio. the input to the convolutional network is the
center cropped 224x224 image. consequently, with 4 max
pooling layers we get an output dimension of the top con-
volutional layer of 14x14. thus in order to visualize the
attention weights for the soft model, we simply upsample
the weights by a factor of 24 = 16 and apply a gaussian
   lter. we note that the receptive    elds of each of the 14x14
units are highly overlapping.
as we can see in figure 2 and 3, the model learns align-
ments that correspond very strongly with human intuition.
especially in the examples of mistakes, we see that it is
possible to exploit such visualizations to get an intuition as
to why those mistakes were made. we provide a more ex-
tensive list of visualizations in appendix a for the reader.

6. conclusion
we propose an attention based approach that gives state
of the art performance on three benchmark datasets us-
ing the id7 and meteor metric. we also show how
the learned attention can be exploited to give more inter-
pretability into the models generation process, and demon-
strate that the learned alignments correspond very well to
human intuition. we hope that the results of this paper will
encourage future work in using visual attention. we also
expect that the modularity of the encoder-decoder approach

combined with attention to have useful applications in other
domains.

acknowledgments
the authors would like to thank the developers of
theano (bergstra et al., 2010; bastien et al., 2012). we
acknowledge the support of the following organizations
for research funding and computing support: the nuance
foundation, nserc, samsung, calcul qu  ebec, compute
canada, the canada research chairs and cifar. the au-
thors would also like to thank nitish srivastava for assis-
tance with his convnet package as well as preparing the
oxford convolutional network and relu patrascu for help-
ing with numerous infrastructure related problems.

references
ba, jimmy lei, mnih, volodymyr, and kavukcuoglu, ko-
recognition with visual attention.

ray. multiple object
arxiv:1412.7755, december 2014.

bahdanau, dzmitry, cho, kyunghyun, and bengio, yoshua. neu-
ral machine translation by jointly learning to align and trans-
late. arxiv:1409.0473, september 2014.

baldi, pierre and sadowski, peter. the dropout learning algo-

rithm. arti   cial intelligence, 210:78   122, 2014.

bastien, frederic, lamblin, pascal, pascanu, razvan, bergstra,
james, goodfellow, ian, bergeron, arnaud, bouchard, nico-
las, warde-farley, david, and bengio, yoshua.
theano:
new features and speed improvements.
submited to the
deep learning and unsupervised id171 nips 2012
workshop, 2012.

bergstra, james, breuleux, olivier, bastien, fr  ed  eric, lam-
blin, pascal, pascanu, razvan, desjardins, guillaume, turian,
joseph, warde-farley, david, and bengio, yoshua. theano: a
cpu and gpu math expression compiler. in proceedings of
the python for scienti   c computing conference (scipy), 2010.

chen, xinlei and zitnick, c lawrence. learning a recurrent
arxiv

visual representation for image id134.
preprint arxiv:1411.5654, 2014.

cho, kyunghyun, van merrienboer, bart, gulcehre, caglar,
bougares, fethi, schwenk, holger, and bengio, yoshua.
learning phrase representations using id56 encoder-decoder
for id151. in emnlp, october 2014.

corbetta, maurizio and shulman, gordon l. control of goal-
directed and stimulus-driven attention in the brain. nature re-
views neuroscience, 3(3):201   215, 2002.

denil, misha, bazzani, loris, larochelle, hugo, and de freitas,
nando. learning where to attend with deep architectures for
image tracking. neural computation, 2012.

denkowski, michael and lavie, alon. meteor universal: lan-
guage speci   c translation evaluation for any target language.
in proceedings of the eacl 2014 workshop on statistical ma-
chine translation, 2014.

neural image id134 with visual attention

donahue,

jeff, hendrikcs, lisa anne, guadarrama, se-
gio, rohrbach, marcus, venugopalan, subhashini, saenko,
long-term recurrent convo-
kate, and darrell, trevor.
lutional networks for visual
recognition and description.
arxiv:1411.4389v2, november 2014.

elliott, desmond and keller, frank. image description using vi-

sual dependency representations. in emnlp, 2013.

fang, hao, gupta, saurabh, iandola, forrest, srivastava, rupesh,
deng, li, doll  ar, piotr, gao, jianfeng, he, xiaodong, mitchell,
margaret, platt, john, et al. from captions to visual concepts
and back. arxiv:1411.4952, november 2014.

hochreiter, s. and schmidhuber, j. long short-term memory.

neural computation, 9(8):1735   1780, 1997.

hodosh, micah, young, peter, and hockenmaier, julia. framing
image description as a ranking task: data, models and evalu-
ation metrics. journal of arti   cial intelligence research, pp.
853   899, 2013.

karpathy, andrej and li, fei-fei. deep visual-semantic align-
ments for generating image descriptions. arxiv:1412.2306,
december 2014.

kingma, diederik p. and ba, jimmy.

adam: a method
for stochastic optimization. arxiv:1412.6980, december
2014.

kiros, ryan, salahutdinov, ruslan, and zemel, richard. multi-
modal neural language models. in international conference on
machine learning, pp. 595   603, 2014a.

kiros, ryan, salakhutdinov, ruslan, and zemel, richard. uni-
fying visual-semantic embeddings with multimodal neural lan-
guage models. arxiv:1411.2539, november 2014b.

krizhevsky, alex, sutskever, ilya, and hinton, geoffrey.

ima-
genet classi   cation with deep convolutional neural networks.
in nips. 2012.

kulkarni, girish, premraj, visruth, ordonez, vicente, dhar, sag-
nik, li, siming, choi, yejin, berg, alexander c, and berg,
tamara l. babytalk: understanding and generating simple im-
age descriptions. pami, ieee transactions on, 35(12):2891   
2903, 2013.

kuznetsova, polina, ordonez, vicente, berg, alexander c, berg,
tamara l, and choi, yejin. collective generation of natural
image descriptions. in association for computational linguis-
tics. acl, 2012.

kuznetsova, polina, ordonez, vicente, berg, tamara l, and choi,
yejin. treetalk: composition and compression of trees for im-
age descriptions. tacl, 2(10):351   362, 2014.

larochelle, hugo and hinton, geoffrey e. learning to com-
bine foveal glimpses with a third-order id82. in
nips, pp. 1243   1251, 2010.

li, siming, kulkarni, girish, berg, tamara l, berg, alexander c,
and choi, yejin. composing simple image descriptions us-
ing web-scale id165s. in computational natural language
learning. acl, 2011.

lin, tsung-yi, maire, michael, belongie, serge, hays, james,
perona, pietro, ramanan, deva, doll  ar, piotr, and zitnick,
c lawrence. microsoft coco: common objects in context. in
eccv, pp. 740   755. 2014.

mao, junhua, xu, wei, yang, yi, wang, jiang, and yuille, alan.
deep captioning with multimodal recurrent neural networks
(m-id56). arxiv:1412.6632, december 2014.

mitchell, margaret, han, xufeng, dodge, jesse, mensch, alyssa,
goyal, amit, berg, alex, yamaguchi, kota, berg, tamara,
stratos, karl, and daum  e iii, hal. midge: generating im-
age descriptions from id161 detections. in european
chapter of the association for computational linguistics, pp.
747   756. acl, 2012.

mnih, volodymyr, hees, nicolas, graves, alex,

and
recurrent models of visual atten-

kavukcuoglu, koray.
tion. in nips, 2014.

pascanu, razvan, gulcehre, caglar, cho, kyunghyun, and ben-
gio, yoshua. how to construct deep recurrent neural networks.
in iclr, 2014.

rensink, ronald a. the dynamic representation of scenes. visual

cognition, 7(1-3):17   42, 2000.

russakovsky, olga, deng, jia, su, hao, krause, jonathan,
satheesh, sanjeev, ma, sean, huang, zhiheng, karpathy, an-
drej, khosla, aditya, bernstein, michael, berg, alexander c.,
and fei-fei, li.
id163 large scale visual recognition
challenge, 2014.

simonyan, k. and zisserman, a.

very deep convolu-
tional networks for large-scale image recognition. corr,
abs/1409.1556, 2014.

snoek, jasper, larochelle, hugo, and adams, ryan p. practi-
cal bayesian optimization of machine learning algorithms. in
nips, pp. 2951   2959, 2012.

snoek, jasper, swersky, kevin, zemel, richard s, and adams,
input warping for bayesian optimization of non-

ryan p.
stationary functions. arxiv preprint arxiv:1402.0929, 2014.

srivastava, nitish, hinton, geoffrey, krizhevsky, alex, sutskever,
ilya, and salakhutdinov, ruslan. dropout: a simple way to
prevent neural networks from over   tting. jmlr, 15, 2014.

sutskever, ilya, vinyals, oriol, and le, quoc vv. sequence to
sequence learning with neural networks. in nips, pp. 3104   
3112, 2014.

szegedy, christian, liu, wei, jia, yangqing, sermanet, pierre,
reed, scott, anguelov, dragomir, erhan, dumitru, van-
houcke, vincent, and rabinovich, andrew. going deeper with
convolutions. arxiv preprint arxiv:1409.4842, 2014.

tang, yichuan, srivastava, nitish, and salakhutdinov, ruslan r.
learning generative models with visual attention. in nips, pp.
1808   1816, 2014.

tieleman, tijmen and hinton, geoffrey. lecture 6.5 - rmsprop.

technical report, 2012.

vinyals, oriol, toshev, alexander, bengio, samy, and erhan,
dumitru. show and tell: a neural image caption generator.
arxiv:1411.4555, november 2014.

neural image id134 with visual attention

weaver, lex and tao, nigel. the optimal reward baseline for
gradient-based id23. in proc. uai   2001, pp.
538   545, 2001.

williams, ronald j. simple statistical gradient-following al-
gorithms for connectionist id23. machine
learning, 8(3-4):229   256, 1992.

yang, yezhou, teo, ching lik, daum  e iii, hal, and aloimonos,
yiannis. corpus-guided sentence generation of natural images.
in emnlp, pp. 444   454. acl, 2011.

young, peter, lai, alice, hodosh, micah, and hockenmaier, julia.
from image descriptions to visual denotations: new similarity
metrics for semantic id136 over event descriptions. tacl,
2:67   78, 2014.

zaremba, wojciech, sutskever, ilya, and vinyals, oriol. re-
arxiv preprint

current neural network id173.
arxiv:1409.2329, september 2014.

neural image id134 with visual attention

a. appendix
visualizations from our    hard    (a) and    soft    (b) attention model. white indicates the regions where the model roughly
attends to (see section 5.4).

(a) a man and a woman playing frisbee in a    eld.

(b) a woman is throwing a frisbee in a park.

figure 6.

aamanmanandandaawomanwomanplayingplayingfrisbeefrisbeeininaafieldfield..neural image id134 with visual attention

(a) a giraffe standing in the    eld with trees.

(b) a large white bird standing in a forest.

figure 7.

aagiraffegiraffestandingstandingininaafieldfieldwithwithtreestrees..neural image id134 with visual attention

(a) a dog is laying on a bed with a book.

(b) a dog is standing on a hardwood    oor.

figure 8.

aadogdogisislayinglayingononaabedbedwithwithaabookbook..neural image id134 with visual attention

(a) a woman is holding a donut in his hand.

(b) a woman holding a clock in her hand.

figure 9.

aawomanwomanisisholdingholdingaadonutdonutininhishishandhand..neural image id134 with visual attention

(a) a stop sign with a stop sign on it.

(b) a stop sign is on a road with a mountain in the background.

figure 10.

aastopstopsignsignwithwithaastopstopsignsignononitit..neural image id134 with visual attention

(a) a man in a suit and a hat holding a remote control.

(b) a man wearing a hat and a hat on a skateboard.

figure 11.

aamanmanininaasuitsuitandandaahathatholdingholdingaaremoteremotecontrolcontrol..neural image id134 with visual attention

(a) a little girl sitting on a couch with a teddy bear.

(b) a little girl sitting on a bed with a teddy bear.

aalittlelittlegirlgirlsittingsittingononaacouchcouchwithwithaateddyteddybearbear..neural image id134 with visual attention

(a) a man is standing on a beach with a surfboard.

(b) a person is standing on a beach with a surfboard.

aamanmanisisstandingstandingononaabeachbeachwithwithaasurfboardsurfboard..neural image id134 with visual attention

(a) a man and a woman riding a boat in the water.

(b) a group of people sitting on a boat in the water.

figure 12.

aamanmanandandaawomanwomanridingridingaaboatboatininthethewaterwater..neural image id134 with visual attention

(a) a man is standing in a market with a large amount of food.

(b) a woman is sitting at a table with a large pizza.

figure 13.

aamanmanisisstandingstandingininaamarketmarketwithwithaalargelargeamountamountofoffoodfood..neural image id134 with visual attention

(a) a giraffe standing in a    eld with trees.

(b) a giraffe standing in a forest with trees in the background.

figure 14.

aagiraffegiraffestandingstandingininaafieldfieldwithwithtreestrees..neural image id134 with visual attention

(a) a group of people standing next to each other.

(b) a man is talking on his cell phone while another man watches.

figure 15.

aagroupgroupofofpeoplepeoplestandingstandingnextnexttotoeacheachotherother..