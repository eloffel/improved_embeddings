coherent dialogue with attention-based language models

hongyuan mei

johns hopkins university

hmei@cs.jhu.edu

mohit bansal
unc chapel hill

mbansal@cs.unc.edu

matthew r. walter

tti-chicago

mwalter@ttic.edu

6
1
0
2

 

v
o
n
1
2

 

 
 
]
l
c
.
s
c
[
 
 

1
v
7
9
9
6
0

.

1
1
6
1
:
v
i
x
r
a

abstract

we model coherent conversation continuation via id56-
based dialogue models equipped with a dynamic attention
mechanism. our attention-id56 language model dynami-
cally increases the scope of attention on the history as the
conversation continues, as opposed to standard attention (or
alignment) models with a    xed input scope in a sequence-to-
sequence model. this allows each generated word to be asso-
ciated with the most relevant words in its corresponding con-
versation history. we evaluate the model on two popular dia-
logue datasets, the open-domain movietriples dataset and the
closed-domain ubuntu troubleshoot dataset, and achieve sig-
ni   cant improvements over the state-of-the-art and baselines
on several metrics, including complementary diversity-based
metrics, human evaluation, and qualitative visualizations. we
also show that a vanilla id56 with dynamic attention outper-
forms more complex memory models (e.g., lstm and gru)
by allowing for    exible, long-distance memory. we promote
further coherence via id96-based reranking.

introduction

automatic conversational models (winograd 1971), also
known as dialogue systems, are of great importance to a
large variety of applications, ranging from open-domain en-
tertaining chatbots to goal-oriented technical support agents.
an increasing amount of research has recently been done
to build purely data-driven dialogue systems that learn from
large corpora of human-to-human conversations, without us-
ing hand-crafted rules or templates. while most work in
this area formulates dialogue modeling in a sequence-to-
sequence framework (similar to machine translation) (rit-
ter, cherry, and dolan 2011; shang, lu, and li 2015;
vinyals and le 2015; sordoni et al. 2015; li et al. 2016a;
du  sek and jur  c      cek 2016), some more recent work (serban
et al. 2016; luan, ji, and ostendorf 2016) instead trains a
language model over the entire dialogue as one single se-
quence.
in our work, we empirically demonstrate that a
language model is better suited to dialogue modeling, as
it learns how the conversation evolves as information pro-
gresses. sequence-to-sequence models, on the other hand,
learn only how the most recent dialogue response is gener-
ated. such models are better suited to converting the same
information from one modality to another, e.g., in machine
translation and image captioning.

we improve the coherence of such neural dialogue lan-
guage models by developing a generative dynamic attention
mechanism that allows each generated word to choose which
related words it wants to align to in the increasing conver-
sation history (including the previous words in the response
being generated). neural attention (or alignment) has proven
very successful for various sequence-to-sequence tasks by
associating salient items in the source sequence with the
generated item in the target sequence (mnih et al. 2014;
bahdanau, cho, and bengio 2015; xu et al. 2015; mei,
bansal, and walter 2016a; parikh et al. 2016). however,
such id12 are limited to a    xed scope of his-
tory, corresponding to the input source sequence. in con-
trast, we introduce a dynamic attention mechanism to a re-
current neural network (id56) language model in which the
scope of attention increases as the recurrence operation pro-
gresses from the start through the end of the conversation.

the dynamic attention model promotes coherence of the
generated dialogue responses (continuations) by favoring
the generation of words that have syntactic or semantic asso-
ciations with salient words in the conversation history. our
simple model shows signi   cant improvements over state-of-
the-art models and baselines on several metrics (including
complementary diversity-based metrics, human evaluation,
and qualitative visualizations) for two benchmark datasets,
the open-domain movietriples and closed-domain ubuntu
troubleshoot datasets. our vanilla id56 model with dy-
namic attention outperforms more complex memory mod-
els (e.g., lstm and gru) by allowing for long-distance
and    exible memory. we also present several visualizations
to intuitively understand what the attention model is learn-
ing. finally, we also explore a complementary lda-based
method to re-rank the outputs of the soft alignment-based
coherence method, further improving performance on the
evaluation benchmarks.

related work

a great deal of attention has been paid to developing data-
driven methods for natural language dialogue generation.
conventional statistical approaches tend to rely extensively
on hand-crafted rules and templates, require interaction with
humans or simulated users to optimize parameters, or pro-
duce conversation responses in an information retrieval fash-
ion. such properties prevent training on the large human

(a) id56 id195 (encoder-decoder) model

(b) id56 language model

(c) attention id195 (encoder-decoder) model

(d) attention language model

figure 1: comparing id56 language models to id56 sequence-to-sequence model, with and without attention.

conversational corpora that are becoming increasingly avail-
able, or fail to produce novel natural language responses.

ritter, cherry, and dolan (2011) formulate dialogue re-
sponse generation as a statistical phrase-based machine
translation problem, which requires no explicit hand-crafted
rules. the recent success of id56s in statistical machine
translation (sutskever, vinyals, and lee 2014; bahdanau,
cho, and bengio 2015) has inspired the application of such
models to the    eld of dialogue modeling. vinyals and le
(2015) and shang, lu, and li (2015) employ an id56 to gen-
erate responses in human-to-human conversations by treat-
ing the conversation history as one single temporally ordered
sequence. in such models, the distant relevant context in the
history is dif   cult to recall. some efforts have been made
to overcome this limitation. sordoni et al. (2015) separately
encode the most recent message and all the previous context
using a bag-of-words representation, which is decoded using
an id56. this approach equates the distance of each word
in the generated output to all the words in the conversation
history, but loses the temporal information of the history.
serban et al. (2016) design a hierarchical model that stacks
an utterance-level id56 on a token-level id56, where the
utterance-level id56 reduces the number of computational
steps between utterances. wen et al. (2015) and wen et al.
(2016) improve spoken id71 via multi-domain and
semantically conditioned neural networks on dialog act rep-
resentations and explicit slot-value formulations.

our work explores the ability of recurrent neural network
language models (bengio et al. 2003; mikolov 2010) to in-
terpret and generate natural language conversations while

still maintaining a relatively simple architecture. we show
that a language model approach outperforms the sequence-
to-sequence model at dialogue modeling. recently, tran,
bisazza, and monz (2016) demonstrated that the neural at-
tention mechanism can improve the effectiveness of a neural
language model. we propose an attention-based neural lan-
guage model for dialogue modeling that learns how a con-
versation evolves as a whole, rather than only how the most
recent response is generated, and that also reduces the num-
ber of computations between the current recurrence step and
the distant relevant context in the conversation history.

the attention mechanism in our model has the additional
bene   t of favoring words that have semantic association
with salient words in the conversation history, which pro-
motes the coherence of the topics in the continued dialogue.
this is important when conversation participants inherently
want to maintain the topic of the discussion. some past
studies have equated coherence with propositional consis-
tency (goldberg 1983), while others see it as a summary
impression (sanders 1983). our work falls in the cate-
gory of viewing coherence as topic continuity (crow 1983;
sigman 1983).
i.e., generating dia-
logue responses with certain properties, have been addressed
recently, such as promoting response diversity (li et al.
2016a), enhancing personal consistency (li et al. 2016b),
and improving speci   city (yao et al. 2016). concurrent with
this work, luan, ji, and ostendorf (2016) improve topic
consistency by feeding into the model the learned lda-
based topic representations. we show that the simple atten-
tion neural language model signi   cantly outperforms such

similar objectives,

outputattentionid56a design. furthermore, we suggest an lda-based re-ranker
complementary to soft neural attention that further promotes
topic coherence.

the model

in this section, we introduce an attention-id56 dialogue
model and compare it to the architectures of basic id56 and
sequence-to-sequence models.

in

both

have

been

neural

networks

sequence-to-sequence models

id56 id195 and language models
successfully
recurrent
used
(id56-
id195, fig. 1a) (sutskever, vinyals, and lee 2014) and in
language models (id56-lm, fig. 1b) (bengio et al. 2003;
mikolov 2010). we    rst discuss language models for
dialogue, which is the primary focus of our work, then
brie   y introduce the sequence-to-sequence model, and
lastly discuss the use of attention methods in both models.
{w0, w1, . . . , wt} with a recurrence function

the id56-lm models a sentence as a sequence of tokens

ht = f (ht   1, wt   1)

(1)

and an output (softmax) function
p (wt = vj|w0:t   1) =

(2)
where the recurrent hidden state ht     rd encodes all the
tokens up to t     1 and is used to compute the id203 of
generating vj     v as the next token from the vocabulary v .

exp g(ht, vj)
i exp g(ht, vi)

(cid:80)

,

the functions f and g are typically de   ned as

vj

ht,

g(ht, vj) = o(cid:62)

f (ht   1, wt   1) = tanh(hht   1 + p ewt   1)

(3a)
(3b)
where h     rd  d is the recurrence matrix, ewt   1 is a
column of id27 matrix e     rde  v that corre-
sponds to wt   1, p     rd  de projects id27 into
the space of the same dimension d as the hidden units, and
o     rd  v is the output id27 matrix with col-
umn vector ovj corresponding to vj.

we train the id56-lm, i.e, estimate the parameters h,
p , e and o, by maximizing the log-likelihood on a set of
natural language training sentences of size n

n(cid:88)

tn(cid:88)

n=1

t=0

(cid:96) =

1
n

log p (wt|w0:t   1)

(4)

since the entire architecture is differentiable, the objective
can be optimized by back-propagation.

when dialogue is formulated as a sequence-to-sequence
task, the id56-id195 model can be used in order to pre-
l} given an
dict a target sequence wt
1 , . . . , wt
m}. in such
input source sequence ws
1 , . . . , ws
settings, an encoder id56 represents the input as a sequence
m}, and a separate
of hidden states hs
decoder id56 then predicts the target sequence token-by-
0:m .
token given the encoder hidden states hs

0:l = {wt
0:m = {ws

0:m = {hs

0 , wt
0 , ws

1 , . . . , hs

0 , hs

attention in id56-id195 models
there are several ways by which to integrate the sequence of
hidden states hs
0:m in the decoder id56. an attention mech-
anism (fig. 1c) has proven to be particularly effective for
various related tasks in machine translation, image caption
synthesis, and language understanding (mnih et al. 2014;
bahdanau, cho, and bengio 2015; xu et al. 2015; mei,
bansal, and walter 2016a).

the attention module takes as input the encoder hidden
l   1 at
state sequence hs
each step l     1, and returns a context vector zl computed as
a weighted average of encoder hidden states hs

0:m and the decoder hidden state ht

0:m

  lm = b(cid:62) tanh(w ht

l   1 + u hs
m)

m(cid:88)

  lm = exp(  lm)/

exp(  lm)

m(cid:88)

m=0

zl =

m=0

  lmhs
m,

where parameters w     rd  d, u     rd  d, and b     rd are
jointly learned with the other model parameters. the context
vector zl is then used as an extra input to the decoder id56
at step l together with wt
0:l   1 to predict the next token wt
l .
attention in id56-lm
we develop an attention-id56 language model (a-id56-
lm) as illustrated in figure 1d, and describe how it can be
used in the context of dialogue modeling. we then describe
its advantages compared to the use of attention in sequence-
to-sequence models.
as with the id56-lm, the model    rst encodes the in-
put into a sequence of hidden states up to word t     1
(eqn. 1). given a representation of tokens up to t     1
{r0, r1, . . . , rt   1} (which we de   ne shortly),
the atten-
tion module computes the context vector zt at step t as a
weighted average of r0:t   1

  ti = b(cid:62) tanh(w ht   1 + u ri)

t   1(cid:88)

  ti = exp(  ti)/

exp(  ti)

t   1(cid:88)

i=0

zt =

i=0

  tiri

(5a)

(5b)

(5c)

(6a)

(6b)

(6c)

we then use the context vector zt together with the hidden
state ht to predict the output at time t

g(ht, zt, vj) = o(cid:62)

(7a)

(cid:80)

(ohht + ozzt)
vj
exp g(ht, zt, vj)
i exp g(ht, zt, vi)

,

p (wt = vj|w0:t   1) =

(7b)
where oh     rd  d and oz     rd  dz project ht and zt, re-
spectively, into the same space of dimension d.

there are multiple bene   ts of using an attention-id56
language model for dialogue, which are empirically sup-
ported by our experimental results. first, a complete dia-
logue is usually composed of multiple turns. a language

model over the entire dialogue is expected to better learn
how a conversation evolves as a whole, unlike a sequence-
to-sequence model, which only learns how the most recent
response is generated and is better suited to translation-
style tasks that transform the same information from one
modality to another. second, compared to lstm models,
an attention-based id56-lm also allows for gapped con-
text and a    exible combination of conversation history for
every individual generated token, while maintaining low
model complexity. third, id12 yield inter-
pretable results   we visualize the learned attention weights,
showing how attention chooses the salient words from the
dialogue history that are important for generating each new
word. such a visualization is typically harder for the hidden
states and gates of conventional lstm and id56 language
models.

with an attention mechanism, there are multiple options
for de   ning the token representation r0:t   1. the original
attention model introduced by bahdanau, cho, and bengio
(2015) uses the hidden units h0:t   1 as the token representa-
tions r0:t   1. recent work (mei, bansal, and walter 2016a;
mei, bansal, and walter 2016b) has demonstrated that per-
formance can be improved by using multiple abstractions of
i )(cid:62), which is what we use in
the input, e.g., ri = (e(cid:62)
this work.

, h(cid:62)

wi

lda-based re-ranking
while the trained attention-id56 dialogue model generates
a natural language continuation of a conversation while
maintaining topic concentration by token association, some
dialogue-level topic-supervision can help to encourage gen-
erations that are more topic-aware. such supervision is
not commonly available, and we use unsupervised meth-
ods to learn document-level latent topics. we employ the
learned topic model to select the best continuation based on
document-level topic-matching.

we choose id44 (lda) (blei, ng,
and jordan 2003; blei and lafferty 2009) due to its demon-
strated ability to learn a distribution over latent topics given
a collection of documents. this generative model assumes
documents {w0:tn}n
n=1 arise from k topics, each of which
is de   ned as a distribution over a    xed vocabulary of terms,
which forms a graphical structure l that can be learned from
the training data. the topic representation      of a (possi-
bly unseen) dialogue w0:t can then be estimated with the
learned topic structure l as     (w0:t ) = l(w0:t ).
given a set of generated continuations {cm}m

m=1 for each
unseen dialogue w0:t , the topic representations of the di-
alogue and its continuations are     (w0:t ) = l(w0:t ) and
    (cm) = l(cm), respectively. we employ a matching score

sm = s(cid:0)    (w0:t ),     (cm)(cid:1) to compute the similarity between

    (w0:t ) and each     (cm).
in the end, a weighted score is
computed as   sm =   sm + (1       )(cid:96)(cm|w0:t ), where       
[0, 1] and (cid:96)(cm|w0:t ) is the conditional log-likelihood of the
continuation cm. the hyper-parameters k and    are tuned
on a development set.

concurrent with our work, luan, ji, and ostendorf (2016)

use learned topic representations      of the given conversation
as an extra feature in a language model to enhance the topic
coherence of the generation. as we show in the results and
analysis section, our model signi   cantly outperforms this
approach.

experimental setup

dataset
we train and evaluate the models on two large natural
language dialogue datasets, movietriples (pre-processed
by serban et al. (2016)) and ubuntu troubleshoot (pre-
processed by luan, ji, and ostendorf (2016)). the dia-
logue within each of these datasets consists of a sequence
of utterances (turns), each of which is a sequence of tokens
(words).1 the accompanying supplementary material pro-
vides the statistics for these two datasets.

id74
for the sake of comparison, we closely follow previous
work and adopt several standard (and complementary) eval-
uation metrics: perplexity (ppl), word error rate (wer), re-
call@n, id7, and diversity-based distinct-1. we provide
further discussion of the various metrics and their advan-
tages in the supplementary material. on the movietriples
dataset, we use ppl and wer, as is done in previous work.
following serban et al. (2016), we adopt two versions for
each metric: i) ppl as the word-level perplexity over the en-
tire dialogue conversation; ii) ppl@l as the word-level per-
plexity over the last utterance of the conversation; iii) wer;
and iv) wer@l (de   ned similarly).

on the ubuntu dataset, we follow previous work and use
ppl and recall@n. recall@n (manning et al. 2008) eval-
uates a model by measuring how often the model ranks the
correct dialogue continuation within top-n given 10 candi-
dates. additionally, we also employ the id7 score (pap-
ineni et al. 2001) to evaluate the quality of the generations
produced by the models. following luan, ji, and osten-
dorf (2016), we perform model selection using ppl on the
development set, and perform the evaluation on the test set
using the other metrics. we also present evaluation using
the distinct-1 metric (proposed by li et al. (2016a)) to mea-
sure the ability of the a-id56 to promote diversity in the
generations, because typical neural dialogue models gener-
ate generic, safe responses (technically appropriate but not
informative, e.g.,    i dont know   ). finally, we also present a
preliminary human evaluation.

training details
for the movietriples dataset, we follow the same proce-
dure as serban et al. (2016) and    rst pretrain on the large
q-a subtitle dataset (ameixa et al. 2014), which contains
5.5m question-answer pairs from which we randomly sam-
ple 20000 pairs as the held-out set, and then    ne-tune on the

1following luan, ji, and ostendorf (2016), we randomly sam-
ple nine utterances as negative examples of the last utterance for
each conversation in ubuntu troubleshoot for the development set.

a: person , but this time i got the money .

a: person , but this time i got the money .

r: if you give it to me , i might forget i found you .

r: if you give it to me , i might forget i found you .

a: i     ll give it to you .

a: i     ll give it to you .

(a) movietriples

a: i have really choppy streaming video in 9.10 ,

a: i have really choppy streaming video in 9.10 ,

any way to    x that ?

any way to    x that ?

a: any way to    x choppy streaming video in 9.10 ?

a: any way to    x choppy streaming video in 9.10 ?

r: what kind of video

r: what video card do you have ?

r: what kind of video

r: what video card do you have ?

(b) ubuntu troubleshoot

figure 2: a visualization of attention on the (a) movietriples and (b) ubuntu troubleshooting datasets, showing which words in the conver-
sation history are being aligned to, for each generated response word. shaded intervals indicate the strength with which the corresponding
words in the conversation history and response are attend to when generating the bolded word in the response. we show this for two generated
words in the same response (left and right column).

target movietriples dataset. we perform early-stopping ac-
cording to the ppl score on the held-out set. we train the
models for both the movietriples and ubuntu troubleshoot
datasets using adam (kingma and ba 2015) for optimiza-
tion in id56 back-propagation. the accompanying sup-
plementary material provides additional training details, in-
cluding the hyper-parameter settings.

results and analysis
primary dialogue modeling results
in this section, we compare the performance on several met-
rics of our attention-based id56-lm with id56 baselines
and state-of-the-art models on the two benchmark datasets.
table 1 reports ppl and wer results on the movietriples
test set, while table 2 compares different models on ubuntu
troubleshoot in terms of ppl on the development set and
recall@n (n = 1 and 2) on the test set (following what
previous work reports).
in the tables, id56 is the plain
vanilla id56 language model (id56-lm), as de   ned in
the model section, and lstm is an lstm-id56 language
model, i.e., an id56-lm with lstm memory units. a-
id56 refers to our main model as de   ned in the atten-
tion in id56-lm section. hred in table 1 is the hier-
archical neural dialogue model proposed by serban et al.
(2016).2 lda-conv in table 2 is proposed by luan, ji,
and ostendorf (2016), which integrates learned lda-topic-
proportions into an lstm language model in order to pro-
mote topic-concentration in the generations. both tables
demonstrate that the attention-id56-lm (a-id56) model

table 1: results on the movietriples test set. the hred results
are from serban et al. (2016).

ppl

model
id56
27.09
hred
26.81
a-id56 25.52

ppl@l

wer

wer@l

26.67
26.31
23.46

64.07%
64.10%
63.93%
63.91%
61.58% 60.15%

table 2: ubuntu troubleshoot ppl and recall@n, with lstm and
lda-conv results from luan et al. (2016).

model
id56
lstm
lda-conv
a-id56

ppl

recall@1

recall@2

56.16
54.93
51.13
45.38

11%
12%
13%
17%

22%
22%
24%
30%

achieves the best results reported to-date on these datasets
in terms all id74.
it improves the ability of
an id56-lm to model continuous dialogue conversations,
while keeping the model architecture simple.

table 3: id56-lm vs. id56-id195

ppl
id56-id195
id56-lm

movietriples ubuntu troubleshoot

35.10
27.81

104.61
56.16

2we compare to their best-performing model version,

adopts bidirectional gated-unit id56 (gru).

that

we also evaluate the effectiveness of the id56-lm and
id56-id195 models on both the movietriples and ubuntu

table 4: id7 score on ubuntu troubleshoot

table 5: generation diversity results: a-id56 vs. id56

model
id56
a-id56
t-a-id56
a-id56-rr
t-a-id56-rr

dev id7 test id7

0.1846
0.2702
0.2908
0.4696
0.4895

0.1692
0.3713
0.3128
0.4279
0.3971

history:

a: person , but this time i got the money .
r: if you give it to me , i might forget i found you .

a-id56:
id56:
reference: a: i don     t have it with me . tell person .

a: i     ll give it to you .
a: i don     t know .

(a) movietriples

history:

a: i have really choppy streaming video in 9.10, any way to    x that?
a: any way to    x choppy streaming video in 9.10 ?
r: what kind of video

a-id56:
id56:
reference: a: what cpu do you have

a: what video card do you have ?
a: what are you trying to do ?

(a) ubuntu troubleshoot

figure 5: examples of responses generated by the a-id56.

troubleshoot development sets. as shown in table 3, the
id56 language model yields lower perplexity than the id56
sequence-to-sequence model on both datasets. hence, we
present all primary results on our primary a-id56 attention-
based id56 language model.3

generation diversity results
next, we investigate the ability of the a-id56 to promote
diversity in the generations, compared to that of the vanilla
id56 using the distinct-1 metric proposed by li et al.
(2016a). distinct-1 is computed as the number of distinct
unigrams in the generation scaled by the total number of
generated tokens. table 5 shows that our attention-based
id56 language model (a-id56) yields much more diversity
in its generations as compared to the vanilla id56 baseline.

topic coherence results
next, we investigate the ability of the different mod-
els to promote topic coherence in the generations in
terms of id7 score.
in addition to the id56 and a-
id56 models, we consider t-a-id56, a method that in-
corporates lda-based topic information into an a-id56
model,
following the approach of luan, ji, and os-
tendorf (2016). we also evaluate our lda-based re-
ranker, a-id56-rr, which re-ranks according to the score
  sm =   sm + (1       )(cid:96)(cm|w0:t ), where we compute the
log-likelihood (cid:96)(cm|w0:t ) based upon a trained a-id56-m
model and validate the weight    on the development set. we

3experiments also demonstrate signi   cant improvements for

the attention-id56-lm over the attention-id56-id195.

distinct-1 movietriples ubuntu troubleshoot
id56
a-id56

0.0007
0.0104

0.0004
0.0028

also consider a method that combines the t-a-id56 model
with an lda-based re-ranker (t-a-id56-rr).4 table 4 re-
ports the resulting id7 scores for each of these methods
on the development and test sets from the ubuntu trou-
bleshoot dataset. we make the following observations based
upon these results: (1) the a-id56 performs substantially
better than the id56 with regards to id7; (2) using our
lda-based re-ranker further improves the performance by
a signi   cant amount (a-id56 v.s. a-id56-rr); (3) as op-
posed to our lda-based re-ranker, adopting the lda de-
sign of luan, ji, and ostendorf (2016) only yields marginal
improvements on the development set, but does not general-
ize well to the test set (a-id56 v.s. t-a-id56 and a-id56-
rr v.s. t-a-id56-rr). also, our lda re-ranker results in
substantial improvements even on top of their topic-based
model (t-a-id56 v.s. t-a-id56-rr).

preliminary human evaluation
in addition to multiple automatic metrics, we also report a
preliminary human evaluation. on each dataset, we manu-
ally evaluate the generations of both the a-id56 and id56
models on 100 examples randomly sampled from the test
set. for each example, we randomly shuf   e the two response
generations, anonymize the model identity, and ask a human
annotator to choose which response generation is more topi-
cally coherent based on the conversation history. as table 6
shows, the a-id56 model wins substantially more often than
the id56 model.

table 6: human evaluaton: a-id56 vs. id56

movietriples ubuntu troubleshoot

not distinguishable
id56 wins
a-id56 wins

48%
6%
46%

74%
5%
21%

qualitative analysis
next, we qualitatively evaluate the effectiveness of our a-
id56 model through visualizations of the attention and out-
puts on both datasets. figure 2 provides a visualization of
the attention for a subset of the words in the generation for
the two datasets. the last line in both fig. 2a and fig. 2b
presents the generated response and we highlight in bold two
output words (one on the left and one on the right) for two

4since luan, ji, and ostendorf (2016) do not publish id7
scores or implementations of their models, we can not compare
with lda-conv on id7. instead, we demonstrate the effect of
adding the key component of lda-conv on top of the a-id56.

time steps. for each highlighted generated word, we visual-
ize the attention weights for words in the conversation his-
tory (i.e., words in the preceding turns and those previously
generated in the output response), where darker shades indi-
cate larger attention weights. as the    gure indicates, the at-
tention mechanism helps learn a better id56 language model
that promotes topic coherence, by learning to associate the
currently-generated word with informative context words in
the conversation history. as shown in figure 6a, the a-id56
generates meaningful and topically coherent responses on
the movietriples dataset. in comparison, the vanilla id56
tends to produce generic answers, such as    i don   t know   .
similarly, the a-id56 follows up with useful questions on
the ubuntu troubleshoot dataset (fig. 6b).

conclusion

we investigate how to improve the performance of a recur-
rent neural network dialogue model via an attention mech-
anism, and how to promote topic and saliency aware con-
versation continuation. our attention-id56 language model
increases the scope of attention continuously as the conver-
sation progresses (which distinguishes it from standard at-
tention with    xed scope in a sequence-to-sequence models)
such that each generated word can be associated with its
most related words in the conversation history. we evalu-
ate this simple model on two large dialogue datasets (movi-
etriples and ubuntu troubleshoot), and achieve the best
results reported to-date on multiple dialogue metrics (in-
cluding complementary diversity-based metrics), perform-
ing better than gate-based id56 memory models. we also
promote topic concentration by adopting lda-based rerank-
ing, further improving performance.

acknowledgments

we thank iulian serban, yi luan, and the anonymous re-
viewers for sharing their datasets and for their helpful dis-
cussion. we thank nvidia corporation for donating gpus
used in this research.

appendix
lda-based re-ranking details
while the trained attention-id56 dialogue model generates a
natural language continuation of a conversation while main-
taining topic concentration by token saliency/association,
some dialogue-level topic-supervision can help to encour-
age generations that are more topic-aware. such supervi-
sion is not commonly available, and we use unsupervised
methods to learn document-level latent topics, and adopt the
learned topic model to select the best continuation based on
document-level topic-matching.

we choose id44 (lda) (blei, ng,
and jordan 2003; blei and lafferty 2009) due to its demon-
strated ability to learn a distribution over latent topics given
a collection of documents. this generative model assumes
that documents arise from multiple topics, each of which is
de   ned as a distribution over a    xed vocabulary of terms.
speci   cally, we can assume that k topics are associated

(cid:16)    (w0:t ),     (cm)
(cid:17)

with a collection of dialogues {w0:tn}n
n=1 in the dialogue
corpus, and that each dialogue exhibits these topics with dif-
ferent likelihoods   n     rk. let dirv (  ) and dirk(  ) de-
note a v - and k-dimensional dirichlet distributions with
scalar parameter    and vector parameter        rk, respec-
tively. the associated    and    can be learned by various
methods (blei, ng, and jordan 2003; blei and lafferty 2009;
hoffman, bach, and blei 2010), and the topic proportions     n
of a (possibly unseen) dialogue w0:tn can be estimated with
the learned topic structure l. we let      = l(w0:t ) denote
the estimated topic proportions      of any dialogue w0:t using
the learned topic structure l.
we use the training set to learn the topic structure l with
k topics. having generated a set of continuations {cm}m
m=1
for each unseen dialogue w0:t during testing, we use the
topic structure l to compute the topic proportions for the
dialogue and its continuations,     (w0:t ) = l(w0:t ) and
    (cm) = l(cm), respectively. next, we employ a pre-
de   ned metric sm = s
to compute the
similarity between the topic proportions for the dialogue
    (w0:t ) and each continuation     (cm). finally, we compute
a weighted score   sm =   sm + (1       )(cid:96)(cm|w0:t ), where
       [0, 1] and (cid:96)(cm|w0:t ) is the log-likelihood of the con-
tinuation cm conditioned on the dialogue w0:t . the hyper-
parameters k and    are tuned on a held-out development set
according to the target id74 (de   ned shortly).
concurrent with our work, luan, ji, and ostendorf
(2016) also propose using learned topic representations
     of the given conversation as an extra feature in a
language model
in order to enhance the topic coher-
ence of the generation. they de   ne the function g as
g(ht,     , vj) = o(cid:62)
    ). as we show in the re-
sults and analysis section, our attention-id56 language
models signi   cantly outperform this approach, though it
is possible to further improve the quality of the gen-
eration by combining these methods i.e., by de   ning
g(ht, zt,     , vj) = o(cid:62)
    ) and also using
an lda-based re-ranker.
dataset details
we train and evaluate the models on two large natural
language dialogue datasets, movietriples (pre-processed
by serban et al. (2016)) and ubuntu troubleshoot (pre-
processed by luan, ji, and ostendorf (2016)). the dialogue
within each of these datasets consists of a sequence of utter-
ances (turns), each of which is a sequence of tokens (words).
table 7 provides the statistics for these two datasets.5
id74
for the sake of comparison, we closely follow previous work
and adopt several standard (and complementary) evaluation
metrics (perplexity, word error rate, recall@n and id7,

(ohht + ozzt + o  

(ohht + o  

vj

vj

5following the approach of luan, ji, and ostendorf (2016), we
randomly sample nine utterances as negative examples of the last
utterance for each conversation in the ubuntu troubleshoot for the
development set.

table 7: dataset statistics

training size
dev size
test size
turns / dialogue
avg. tokens / dialogue
vocabulary size

movietriples ubuntu

196308
24717
24271
3
53
10003

216129
13522
10020
6   20
116
20003

diversity-based distinct-1). on the movietriples dataset, we
use perplexity (ppl) and word error rate (wer) as is done
in previous work, due to the metrics    ability to appropriately
quantify the performance of a language model by measuring
its ability to learn the syntactic structure of dialogue. fol-
lowing serban et al. (2016), we adopt two versions for each
metric: i) ppl as the word-level perplexity over the entire di-
alogue conversation; ii) ppl@l as the word-level perplexity
over the last utterance of the conversation; iii) wer as the
word error rate over the entire dialogue conversation; and iv)
wer@l as the word error rate over the last utterance of the
conversation. we use all four metrics for model selection on
the development set and for evaluation on the test set.

on the ubuntu troubleshoot dataset, we follow previous
work and use ppl and recall@n to evaluate the performance
of the proposed language models.
recall@n (manning et
al. 2008) evaluates a model by measuring how often the
model ranks the correct dialogue continuation within top-
n range given 10 candidates. additionally, we also adopt
id7 score (papineni et al. 2001), to evaluate the quality of
generations produced by the models. while not perfect, we
believe that id7 score is a suitable metric for evaluating
topic-concentration, as it evaluates the generated continua-
tion by counting explicit id165 match relative to a set of
references, and because word-matching can be a reasonable
proximity for topic-matching.

finally, we also present evaluation using the diversity-
based distinct-1 metric (proposed by li et al. (2016a)) to
measure the ability of the a-id56 to promote diversity in the
generations, because typical neural dialogue models gener-
ate generic, safe responses (technically appropriate but not
informative, e.g.,    i dont know   ). distinct-1 is computed as
the number of distinct unigrams in the generation scaled by
the total number of generated tokens.

training details
for the movietriples dataset, we follow the same proce-
dure as serban et al. (2016) and    rst pretrain on a large
q-a subtitle dataset
(ameixa et al. 2014) and then    ne-
tune on the target movietriples dataset. the q-a subti-
tle dataset contains approximately 5.5m question-answer
pairs, from which we randomly sample 20000 pairs as the
held-out set. we performed early-stopping according to the
ppl score on the held-out set. we tuned the dimensional-
ity d     {200, 300, 400, 500} of the id56 hidden states, and
chose d = 300. we similarly use a setting of d = 300 on the
ubuntu troubleshoot dataset. we use adam (kingma and
ba 2015) for optimization in id56 back-propagation.

history:

a-id56:

id56:

a: i knew how much you wanted it .
r: but i was going to buy it for myself .

a: i     d like to buy you a drink .

a: i don t know .

reference:

a: i wanted to give it to you . for our anniversary . we met    ve
years ago today .

history:

a-id56:

id56:

a: person , but this time i got the money .
r: if you give it to me , i might forget i found you .

a: i     ll give it to you .

a: i don     t know .

reference:

a: i don     t have it with me . tell person .

(a) movietriples

a: so i need to make an ntfs partition .... help ?
r: install ntfsprogs
r: it will add the functionality to gparted

r: sudo apt-get install ntfsprogs

r: how do i do that ?

history:

a-id56:

id56:

reference:

r: sudo apt-get update ; sudo apt-get install ntfsprogs

a: i have really choppy streaming video in 9.10 , any way to    x
that ?
a: any way to    x choppy streaming video in 9.10 ?
r: what kind of video

r: what video card do you have ?

r: what are you trying to do ?

history:

a-id56:

id56:

reference:

r: what cpu do you have

(b) ubuntu troubleshoot

figure 6: examples of responses generated by the a-id56 along
with the reference response.

when training the attention-id56 dialogue model, we
perform early-stopping and model selection based on the
ppl values on the development set, following luan, ji, and
ostendorf (2016). for the lda-based re-ranker, we choose
the two hyper-parameters, i.e., the number of topics k and
ranking weight   , based on the values of recall@n and
id7 score on the development set. in the end, we choose
k = 10 out of k     {5, 10, 20, 50} and    = 0.45 out of
       {0.00, 0.05, . . . , 0.95, 1.00}.
output examples
we qualitatively evaluate the effectiveness of our a-id56
model through visualizations of the output on both datasets.
the a-id56 generates meaningful and topically coherent re-
sponses on the movietriples dataset (fig. 6a). in compari-
son, the vanilla id56 tends to produce generic answers, such
as    i don   t know   . on the ubuntu troubleshoot dataset, the
a-id56 either provides promising technical solutions or fol-
lows up with useful questions (fig. 6b).

references

[2014] ameixa, d.; coheur, l.; fialho, p.; and quaresma, p. 2014.
luke, i am your father: dealing with out-of-domain requests by us-
ing movies subtitles. in intelligent virtual agents, 13   21. springer.
[2015] bahdanau, d.; cho, k.; and bengio, y. 2015. neural ma-
chine translation by jointly learning to align and translate. in pro-
ceedings of the international conference on learning representa-
tions (iclr).
[2003] bengio, y.; ducharme, r.; vincent, p.; and jauvin, c. 2003.
a neural probabilistic language model. journal of machine learn-
ing research.
[2009] blei, d. m., and lafferty, j. d. 2009. topic models. text
mining: classi   cation, id91, and applications 10(71):34.
[2003] blei, d. m.; ng, a. y.; and jordan, m. i. 2003. latent
dirichlet allocation. the journal of machine learning research.
[1983] crow, b. 1983. topic shifts in couples    conversations. con-
versational coherence: form, structure, and strategy 136   156.
[2016] du  sek, o., and jur  c      cek, f. 2016. a context-aware natural
language generator for dialogue systems. in proceedings of sig-
dial.
[1983] goldberg, j. 1983. a move towards describing conversa-
tional coherence. conversational coherence: form, structure, and
strategy 25   45.
[2010] hoffman, m.; bach, f. r.; and blei, d. m. 2010. online
learning for id44. in advances in neural in-
formation processing systems (nips).
[2015] kingma, d., and ba, j. 2015. adam: a method for stochas-
tic optimization. in proceedings of the international conference
on learning representations (iclr).
[2016a] li, j.; galley, m.; brockett, c.; gao, j.; and dolan, b.
2016a. a diversity-promoting objective function for neural con-
versation models. in proceedings of the conference of the north
american chapter of the association for computational linguis-
tics (naacl).
[2016b] li, j.; galley, m.; brockett, c.; gao, j.; and dolan, b.
2016b. a persona-based neural conversation model. arxiv preprint
arxiv:1603.06155.
[2016] luan, y.; ji, y.; and ostendorf, m. 2016. lstm based
conversation models. arxiv preprint arxiv:1603.09457.
[2008] manning, c. d.; raghavan, p.; sch  utze, h.; et al. 2008.
introduction to information retrieval, volume 1. cambridge uni-
versity press cambridge.
[2016a] mei, h.; bansal, m.; and walter, m. r. 2016a. listen,
attend, and walk: neural mapping of navigational instructions to
action sequences. in proceedings of the national conference on
arti   cial intelligence (aaai).
[2016b] mei, h.; bansal, m.; and walter, m. r. 2016b. what to talk
about and how? selective generation using lstms with coarse-
to-   ne alignment. in proceedings of the conference of the north
american chapter of the association for computational linguis-
tics human language technologies (naacl hlt).
[2010] mikolov, t. 2010. recurrent neural network based language
model. in proceedings of interspeech.
[2014] mnih, v.; hees, n.; graves, a.; and kavukcuoglu, k. 2014.
recurrent models of visual attention. in advances in neural infor-
mation processing systems (nips).
[2001] papineni, k.; roukos, s.; ward, t.; and zhu, w.-j. 2001.
id7: a method for automatic evaluation of machine translation.

in proceedings of the annual meeting of the association for com-
putational linguistics (acl), 311   318.
[2016] parikh, a. p.; t  ackstr  om, o.; das, d.; and uszkoreit, j.
2016. a decomposable attention model for natural language in-
ference. arxiv preprint arxiv:1606.01933.
[2011] ritter, a.; cherry, c.; and dolan, w. b. 2011. data-driven
response generation in social media. in proceedings of the con-
ference on empirical methods in natural language processing
(emnlp).
[1983] sanders, r. 1983. tools for cohering discourse and their
strategic utilization. conversational coherence: form, structure,
and strategy 67   80.
[2016] serban, i. v.; sordoni, a.; bengio, y.; courville, a.; and
pineau, j. 2016. building end-to-end dialogue systems using gen-
in proceedings of the na-
erative hierarchical neural networks.
tional conference on arti   cial intelligence (aaai).
[2015] shang, l.; lu, z.; and li, h. 2015. neural responding
machine for short-text conversation. in proceedings of the annual
meeting of the association for computational linguistics (acl).
[1983] sigman, s. 1983. some multiple constraints placed on con-
versational topics. conversational coherence: form, structure, and
strategy.
[2015] sordoni, a.; galley, m.; auli, m.; brockett, c.; ji, y.;
mitchell, m.; nie, j.-y.; gao, j.; and dolan, b. 2015. a neu-
ral network approach to context-sensitive generation of conversa-
in proceedings of the conference of the north
tional responses.
american chapter of the association for computational linguis-
tics (naacl).
[2014] sutskever, i.; vinyals, o.; and lee, q. v. 2014. sequence
to sequence learning with neural networks. in advances in neural
information processing systems (nips).
[2016] tran, k.; bisazza, a.; and monz, c. 2016. recurrent mem-
ory network for id38. in proceedings of the confer-
ence of the north american chapter of the association for com-
putational linguistics human language technologies (naacl
hlt).
[2015] vinyals, o., and le, q. 2015. a neural conversational
model. in icml deep learning workshop.
[2015] wen, t.-h.; ga  si  c, m.; mrk  si  c, n.; su, p.-h.; vandyke, d.;
and young, s. 2015. semantically conditioned lstm-based natu-
ral language generation for spoken dialogue systems. in proceed-
ings of the conference on empirical methods in natural language
processing (emnlp). association for computational linguistics.
[2016] wen, t.-h.; ga  si  c, m.; mrk  si  c, n.; m. rojas-barahona, l.;
su, p.-h.; vandyke, d.; and young, s. 2016. multi-domain neu-
ral network language generation for spoken dialogue systems. in
proceedings of the conference on north american chapter of the
association for computational linguistics (naacl). association
for computational linguistics.
[1971] winograd, t. 1971. procedures as a representation for data
in a computer program for understanding natural language. tech-
nical report, dtic document.
[2015] xu, k.; ba, j.; kiros, r.; cho, k.; courville, a.; salakhut-
dinov, r.; zemel, r.; and bengio, y. 2015. show, attend and tell:
neural image id134 with visual attention. in proceed-
ings of the international conference on machine learning (icml).
[2016] yao, k.; peng, b.; zweig, g.; and wong, k.-f. 2016. an
attentional neural conversation model with improved speci   city.
arxiv preprint arxiv:1606.01292.

